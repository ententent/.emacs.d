#+TITLE: Emacsé…ç½®æ–‡ä»¶
#+AUTHOR: xiudi
#+DATE: 2023/04/07 20:43:53
#+STARTUP: overview

* early-init.el
:PROPERTIES:
:HEADER-ARGS: :tangle early-init.el
:END:
+ åœ¨Emacsåˆšå¯åŠ¨ï¼Œå°šæœªåŠ è½½ä¸»è¦é…ç½®æ–‡ä»¶æ—¶çš„é…ç½®ã€‚
#+BEGIN_SRC emacs-lisp
  ;;; early-init.el --- Emacs pre-initialization config -*- lexical-binding: t -*-
  ;;; Commentary:

  ;;; Code:

  ;; è®¾ç½®åƒåœ¾å›æ”¶å‚æ•°
  (setq gc-cons-threshold most-positive-fixnum)
  ;;; (setq gc-cons-percentage 0.6)
  ;; æ¸…ç©ºé¿å…åŠ è½½è¿œç¨‹æ–‡ä»¶çš„æ—¶å€™åˆ†ææ–‡ä»¶
  (setq file-name-handler-alist nil)

  ;; å¯åŠ¨æ—©æœŸä¸åŠ è½½`package.el'åŒ…ç®¡ç†å™¨
  (setq package-enable-at-startup nil)
  ;; ä¸ä»åŒ…ç¼“å­˜ä¸­åŠ è½½
  (setq package-quickstart nil)

  ;; ç¦æ­¢å±•ç¤ºèœå•æ ã€å·¥å…·æ å’Œçºµå‘æ»šåŠ¨æ¡
  (push '(menu-bar-lines . 0) default-frame-alist)
  (push '(tool-bar-lines . 0) default-frame-alist)
  (push '(vertical-scroll-bars) default-frame-alist)

  ;; ç¦æ­¢è‡ªåŠ¨ç¼©æ”¾çª—å£å…ˆ
  (setq frame-inhibit-implied-resize t)

  ;; ç¦æ­¢èœå•æ ã€å·¥å…·æ ã€æ»šåŠ¨æ¡æ¨¡å¼ï¼Œç¦æ­¢å¯åŠ¨å±å¹•å’Œæ–‡ä»¶å¯¹è¯æ¡†
  (menu-bar-mode -1)                      ; å…³é—­èœå•æ 
  (tool-bar-mode -1)                      ; å…³é—­å·¥å…·æ 
  (scroll-bar-mode -1)                    ; å…³é—­æ»šåŠ¨æ¡
  (setq inhibit-splash-screen t)
  (setq use-file-dialog nil)

  ;; åœ¨è¿™ä¸ªé˜¶æ®µä¸ç¼–è¯‘
  (setq comp-deferred-compilation nil)

  (provide 'early-init)
  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  ;;; early-init.el ends here
#+END_SRC

* init.el
:PROPERTIES:
:HEADER-ARGS: :tangle init.el
:END:
** init.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init.el --- The main init entry for Emacs -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** package åŒ…ç®¡ç†é…ç½®
#+begin_src emacs-lisp
(require 'package)
(setq package-check-signature nil)
(setq package-archives
	  '(("gnu"          . "http://1.15.88.122/gnu/")
	    ("melpa"        . "http://1.15.88.122/melpa/")
        ("melpa-stable" . "http://1.15.88.122/stable-melpa/")
	    ("nongnu"       . "http://1.15.88.122/nongnu/")))
(package-initialize)
#+end_src
** å®‰è£…use-packageæ’ä»¶
#+BEGIN_SRC emacs-lisp
;; å®‰è£… use-package
(unless (package-installed-p 'use-package)
   (package-refresh-contents)
   (package-install 'use-package))

;; é…ç½® use-package
(eval-and-compile
  (setq use-package-always-ensure nil)
  (setq use-package-always-defer nil)
  (setq use-package-expand-minimally nil)
  (setq use-package-enable-imenu-support t)
  (if (daemonp)
      (setq use-package-always-demand t)))

(eval-when-compile
  (require 'use-package))

;; å®‰è£… use-package çš„é›†æˆæ¨¡å—
(use-package use-package-ensure-system-package
  :ensure t)
(use-package diminish
  :ensure t)
(use-package bind-key
  :ensure t)

;; å®‰è£… benchmark-init, ä¼˜åŒ–Emacså¯åŠ¨é€Ÿåº¦
(require 'benchmark-init-modes)
(require 'benchmark-init)
(benchmark-init/activate)
;;; To disable collection of benchmark data after init is done.
(add-hook 'after-init-hook 'benchmark-init/deactivate)
#+END_SRC
** åŠ è½½å„æ¨¡å—åŒ–é…ç½®
#+BEGIN_SRC emacs-lisp
;; å°†lispç›®å½•æ”¾åœ¨åŠ è½½è·¯å¾„ä¹‹å‰ä»¥æé«˜å¯åŠ¨é€Ÿåº¦
(let ((dir (locate-user-emacs-file "lisp")))
  (add-to-list 'load-path (file-name-as-directory dir)))

;; ä¸è¦åœ¨ *message* ç¼“å†²åŒºæ˜¾ç¤ºåŠ è½½æ¨¡å—åŒ–é…ç½®çš„ä¿¡æ¯
(with-temp-message ""
  (require 'init-ui)
  (require 'init-base)
  (require 'init-dired)
  (require 'init-edit)
  (require 'init-org)
  (require 'init-completion)
  (require 'init-tools)
  (require 'init-dev)
  (require 'init-research)
  (require 'init-eaf)
  (require 'init-ai)
  (require 'init-shell)
  )
#+END_SRC
** init.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init.el ends here
#+END_SRC
* init-ui.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-ui.el :mkdirp yes
:END:
** init-ui.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-ui.el --- UI settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** doom-themesä¸»é¢˜
+ [[https://github.com/doomemacs/themes#manually--use-package][doom-themes]] æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ä¸€ä¸ªä¸»é¢˜åŒ…ã€‚
#+BEGIN_SRC emacs-lisp
(use-package doom-themes
  :ensure t
  :config
   ;; Global settings (defaults)
  (setq doom-themes-enable-bold nil    ; if nil, bold is universally disabled
	doom-themes-enable-italic t) ; if nil, italics is universally disabled
  (load-theme 'doom-peacock t)
  (doom-themes-treemacs-config))
#+END_SRC
** å­—ä½“é…ç½®
*** cn-fonts
- tumashu å¼€å‘çš„ [[https://github.com/tumashu/cnfonts][cnfonts]] æ–¹ä¾¿å®ç°ä¸­è‹±æ–‡å­—ä½“ç­‰å®½å¯¹é½
#+BEGIN_SRC emacs-lisp
;; (use-package cnfonts
;;   :ensure t
;;   :after all-the-icons
;;   :hook (cnfonts-set-font-finish
;;          . (lambda (fontsizes-list)
;;              (set-fontset-font t 'unicode (font-spec :family "Noto Color Emoji") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "Sarasa Term SC Nerd") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "Noto Emoji") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "all-the-icons") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "file-icons") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "Material Icons") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "github-octicons") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "FontAwesome") nil 'append)
;;              (set-fontset-font t 'unicode (font-spec :family "Weather Icons") nil 'append)))

;;   :custom
;;   (cnfonts-personal-fontnames '(("Fira Mono" "JetBrains Mono" "Ubuntu Mono")
;;                                 ("éœé¹œæ–‡æ¥·" "å¾®è½¯é›…é»‘")
;;                                 ("Simsun-ExtB" "æ–¹æ­£èšçæ–°ä»¿ç®€ç¹" "PragmataPro Mono Liga")
;;                                 ("Noto Emoji" "Sarasa Term SC Nerd" "Segoe UI Emoji" "Segoe UI Symbol" "Segoe Print")))
;;   :config
;;   (cnfonts-enable))
#+END_SRC
*** é‡‘è‰²é£è´¼å°ç±³çš„é…ç½®
- å‚è€ƒé“¾æ¥[[https://emacs-china.org/t/emacs/22193][ä¸ºemacsæ­£ç¡®é…ç½®è‹±æ–‡ã€ä¸­æ–‡ã€ç¬¦å·å­—ä½“çš„æ­£ç¡®æ–¹å¼ï¼Ÿ]]
#+BEGIN_SRC emacs-lisp
;; é»˜è®¤å­—ä½“å’Œå­—å· @ https://fonts.google.com/specimen/Fira+Mono
;;; sudo mv * /usr/share/fonts/TTF
;;; sudo fc-cache -f -v
(set-face-attribute 'default nil :font "Fira Mono" :height 160)
;; ä¸­æ–‡é»˜è®¤å­—ä½“ @ https://mrswolf.github.io/my-manjaro-log/
(set-fontset-font "fontset-default" 'han "Kaiti")
;;;(set-fontset-font t 'han (font-spec :family "éœé¹œæ–‡æ¥·" :weight 'bold))
;; æ•°å­¦ç¬¦å·é»˜è®¤å­—ä½“ @ https://wiki.archlinuxcn.org/zh-hans/%E5%BE%AE%E8%BD%AF%E5%AD%97%E4%BD%93
;; ä¿è¯ Unicode æ•°å­¦ç¬¦å·å¯ä»¥æ­£ç¡®æ˜¾ç¤º
(set-fontset-font "fontset-default" 'mathematical "Cambria Math")
;; æ±‰å­—é—´è·æ˜¾ç¤ºé—®é¢˜
(setq inhibit-compacting-font-caches t)
;; å›ºå®šé—´è·å­—ä½“ @ https://www.jetbrains.com/lp/mono/
(set-face-attribute 'fixed-pitch nil :font "JetBrains Mono"  :height 150)
;; å¯å˜é—´è·å­—ä½“
(set-face-attribute 'variable-pitch nil :font "Segoe UI Emoji" :height 160 :weight 'regular)
#+END_SRC
** å…¶ä»–UIé›¶æ•£è®¾ç½®é¡¹
#+begin_src emacs-lisp
  ;; ç¦ç”¨ä¸€äº›GUIç‰¹æ€§
  (setq use-dialog-box nil)               ; é¼ æ ‡æ“ä½œä¸ä½¿ç”¨å¯¹è¯æ¡†
  (setq inhibit-default-init t)           ; ä¸åŠ è½½ `default' åº“
  (setq inhibit-startup-screen t)         ; ä¸åŠ è½½å¯åŠ¨ç”»é¢
  (setq inhibit-startup-message t)        ; ä¸åŠ è½½å¯åŠ¨æ¶ˆæ¯
  (setq inhibit-startup-buffer-menu t)    ; ä¸æ˜¾ç¤ºç¼“å†²åŒºåˆ—è¡¨

  ;; è‰ç¨¿ç¼“å†²åŒºé»˜è®¤æ–‡å­—è®¾ç½®
  (setq initial-scratch-message (concat ";; Happy hacking, "
                                        (capitalize user-login-name) " - Emacs â™¥ you!\n\n"))

  ;; è®¾ç½®ç¼“å†²åŒºçš„æ–‡å­—æ–¹å‘ä¸ºä»å·¦åˆ°å³
  (setq bidi-paragraph-direction 'left-to-right)
  ;; ç¦æ­¢ä½¿ç”¨åŒå‘æ‹¬å·ç®—æ³•
  ;; (setq bidi-inhibit-bpa t)

  ;; è®¾ç½®è‡ªåŠ¨æŠ˜è¡Œå®½åº¦ä¸º80ä¸ªå­—ç¬¦ï¼Œé»˜è®¤å€¼ä¸º70
  (setq-default fill-column 80)

  ;; è®¾ç½®å¤§æ–‡ä»¶é˜ˆå€¼ä¸º100MBï¼Œé»˜è®¤10MB
  (setq large-file-warning-threshold 100000000)

  ;; ä»¥16è¿›åˆ¶æ˜¾ç¤ºå­—èŠ‚æ•°
  (setq display-raw-bytes-as-hex t)
  ;; æœ‰è¾“å…¥æ—¶ç¦æ­¢ `fontification' ç›¸å…³çš„å‡½æ•°é’©å­ï¼Œèƒ½è®©æ»šåŠ¨æ›´é¡ºæ»‘
  (setq redisplay-skip-fontification-on-input t)

  ;; ç¦æ­¢å“é“ƒ
  (setq ring-bell-function 'ignore)

  ;; ç¦æ­¢é—ªçƒå…‰æ ‡
  (blink-cursor-mode -1)

  ;; åœ¨å…‰æ ‡å¤„è€Œéé¼ æ ‡æ‰€åœ¨ä½ç½®ç²˜è´´
  (setq mouse-yank-at-point t)

  ;; æ‹·è´ç²˜è´´è®¾ç½®
  (setq select-enable-primary nil)        ; é€‰æ‹©æ–‡å­—æ—¶ä¸æ‹·è´
  (setq select-enable-clipboard t)        ; æ‹·è´æ—¶ä½¿ç”¨å‰ªè´´æ¿

  ;; é¼ æ ‡æ»šåŠ¨è®¾ç½®
  (setq scroll-step 2)
  (setq scroll-margin 2)
  (setq hscroll-step 2)
  (setq hscroll-margin 2)
  (setq scroll-conservatively 101)
  (setq scroll-up-aggressively 0.01)
  (setq scroll-down-aggressively 0.01)
  (setq scroll-preserve-screen-position 'always)

  ;; å¯¹äºé«˜çš„è¡Œç¦æ­¢è‡ªåŠ¨å‚ç›´æ»šåŠ¨
  (setq auto-window-vscroll nil)

  ;; è®¾ç½®æ–°åˆ†å±æ‰“å¼€çš„ä½ç½®çš„é˜ˆå€¼
  (setq split-width-threshold (assoc-default 'width default-frame-alist))
  (setq split-height-threshold nil)

  ;; TABé”®è®¾ç½®ï¼Œåœ¨Emacsé‡Œä¸ä½¿ç”¨TABé”®ï¼Œæ‰€æœ‰çš„TABé»˜è®¤ä¸º4ä¸ªç©ºæ ¼
  (setq-default indent-tabs-mode nil)
  (setq-default tab-width 4)

  ;; yesæˆ–noæç¤ºè®¾ç½®ï¼Œé€šè¿‡ä¸‹é¢è¿™ä¸ªå‡½æ•°è®¾ç½®å½“ç¼“å†²åŒºåå­—åŒ¹é…åˆ°é¢„è®¾çš„å­—ç¬¦ä¸²æ—¶è‡ªåŠ¨å›ç­”yes
  (setq original-y-or-n-p 'y-or-n-p)
  (defalias 'original-y-or-n-p (symbol-function 'y-or-n-p))
  (defun default-yes-sometimes (prompt)
    "automatically say y when buffer name match following string"
    (if (or
         (string-match "has a running process" prompt)
         (string-match "does not exist; create" prompt)
         (string-match "modified; kill anyway" prompt)
         (string-match "Delete buffer using" prompt)
         (string-match "Kill buffer of" prompt)
         (string-match "still connected.  Kill it?" prompt)
         (string-match "Shutdown the client's kernel" prompt)
         (string-match "kill them and exit anyway" prompt)
         (string-match "Revert buffer from file" prompt)
         (string-match "Kill Dired buffer of" prompt)
         (string-match "delete buffer using" prompt)
         (string-match "Kill all pass entry" prompt)
         (string-match "for all cursors" prompt)
         (string-match "Do you want edit the entry" prompt))
        t
      (original-y-or-n-p prompt)))
  (defalias 'yes-or-no-p 'default-yes-sometimes)
  (defalias 'y-or-n-p 'default-yes-sometimes)

  ;; è®¾ç½®å‰ªè´´æ¿å†å²é•¿åº¦300ï¼Œé»˜è®¤ä¸º60
  (setq kill-ring-max 200)

  ;; åœ¨å‰ªè´´æ¿é‡Œä¸å­˜å‚¨é‡å¤å†…å®¹
  (setq kill-do-not-save-duplicates t)

  ;; è®¾ç½®ä½ç½®è®°å½•é•¿åº¦ä¸º6ï¼Œé»˜è®¤ä¸º16
  ;; å¯ä»¥ä½¿ç”¨ `counsel-mark-ring' or `consult-mark' (C-x j) æ¥è®¿é—®å…‰æ ‡ä½ç½®è®°å½•
  ;; ä½¿ç”¨ C-x C-SPC æ‰§è¡Œ `pop-global-mark' ç›´æ¥è·³è½¬åˆ°ä¸Šä¸€ä¸ªå…¨å±€ä½ç½®å¤„
  ;; ä½¿ç”¨ C-u C-SPC è·³è½¬åˆ°æœ¬åœ°ä½ç½®å¤„
  (setq mark-ring-max 6)
  (setq global-mark-ring-max 6)

  ;; è®¾ç½® emacs-lisp çš„é™åˆ¶
  (setq max-lisp-eval-depth 10000)        ; é»˜è®¤å€¼ä¸º 800
  (setq max-specpdl-size 10000)           ; é»˜è®¤å€¼ä¸º 1600

  ;; å¯ç”¨ `list-timers', `list-threads' è¿™ä¸¤ä¸ªå‘½ä»¤
  (put 'list-timers 'disabled nil)
  (put 'list-threads 'disabled nil)

  ;; åœ¨å‘½ä»¤è¡Œé‡Œæ”¯æŒé¼ æ ‡
  (xterm-mouse-mode 1)

  ;; é€€å‡ºEmacsæ—¶è¿›è¡Œç¡®è®¤
  (setq confirm-kill-emacs 'y-or-n-p)

  ;; å¼€å¯Emacsçš„è§†è§‰æ¢è¡Œæ¨¡å¼
  (visual-line-mode 1)

  ;; åœ¨æ¨¡å¼æ ä¸Šæ˜¾ç¤ºå½“å‰å…‰æ ‡çš„åˆ—å·
  (column-number-mode t)

  ;; å¼€å¯è¡Œå·åä¾¿äºä½¿ç”¨ M-g M-g è·³è½¬åˆ°æŒ‡å®šè¡Œ
  (global-display-line-numbers-mode t)
  ;; Disable line numbers for some modes
  (dolist (mode '(org-mode-hook
                  term-mode-hook
                  eshell-mode-hook
                  pdf-view-mode-hook
                  eww-mode-hook))
    (add-hook mode (lambda () (display-line-numbers-mode 0))))
  ;;; highlight current line
  (global-hl-line-mode t)
#+end_src

** ç¼–ç è®¾ç½®
- Windowsæ‰€ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¸Manjaroä¸åŒï¼Œå¯¼è‡´ä¸­æ–‡å­—ä½“æ— æ³•æ­£ç¡®æ˜¾ç¤º
  - =M-x revert-buffer-with-coding-system RET gbk=
  - =M-x set-buffer-file-coding-system RET utf-8=
- ç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç 
#+BEGIN_SRC emacs-lisp
;; é…ç½®æ‰€æœ‰çš„ç¼–ç ä¸ºUTF-8ï¼Œå‚è€ƒï¼š
;; https://thraxys.wordpress.com/2016/01/13/utf-8-in-emacs-everywhere-forever/
(setq locale-coding-system 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-selection-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-language-environment 'utf-8)
(set-clipboard-coding-system 'utf-8)
(set-file-name-coding-system 'utf-8)
(set-buffer-file-coding-system 'utf-8)
(prefer-coding-system 'utf-8)
(modify-coding-system-alist 'process "*" 'utf-8)
(when (display-graphic-p)
  (setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING)))
#+END_SRC
** æ¨¡å¼æ è®¾ç½®
*** doom-modelineæ’ä»¶
+ [[https://github.com/seagle0128/doom-modeline][doom-modeline]] æ˜¯ä¸€ä¸ªæ¨¡å¼æ ç¾åŒ–æ’ä»¶ã€‚
#+begin_src emacs-lisp
(use-package doom-modeline
  :ensure t
  :hook (after-init . doom-modeline-mode)
  :custom
  (doom-modeline-irc nil)
  (doom-modeline-mu4e nil)
  (doom-modeline-gnus nil)
  (doom-modeline-github nil)
  (doom-modeline-buffer-file-name-style 'truncate-upto-root) ; : auto
  (doom-modeline-persp-name nil)
  (doom-modeline-unicode-fallback t)
  (doom-modeline-enable-word-count nil))
#+end_src
*** minionsæ’ä»¶
+ [[https://github.com/tarsius/minions][minions]] æ’ä»¶èƒ½è®©æ¨¡å¼æ å˜å¾—æ¸…çˆ½ï¼Œå°†æ¬¡è¦æ¨¡å¼éšè—èµ·æ¥ã€‚
#+BEGIN_SRC emacs-lisp
(use-package minions
  :ensure t
  :hook (after-init . minions-mode))
#+END_SRC

** keycastæŒ‰é”®å±•ç¤º
+ [[https://github.com/tarsius/keycast][keycast mode]] æ’ä»¶å¯ä»¥åœ¨æ¨¡å¼æ ä¸Šå±•ç¤ºæ‰€æœ‰çš„æŒ‰é”®ï¼Œä»¥åŠå¯¹åº”çš„å‡½æ•°ã€‚
#+BEGIN_SRC emacs-lisp
(use-package keycast
  :ensure t
  :hook (after-init . keycast-mode)
  ;; :custom-face
  ;; (keycast-key ((t (:background "#0030b4" :weight bold))))
  ;; (keycast-command ((t (:foreground "#0030b4" :weight bold))))
  :config
  ;; set for doom-modeline support
  ;; With the latest change 72d9add, mode-line-keycast needs to be modified to keycast-mode-line.
  (define-minor-mode keycast-mode
    "Show current command and its key binding in the mode line (fix for use with doom-mode-line)."
    :global t
    (if keycast-mode
        (progn
          (add-hook 'pre-command-hook 'keycast--update t)
          (add-to-list 'global-mode-string '("" keycast-mode-line "  ")))
      (remove-hook 'pre-command-hook 'keycast--update)
      (setq global-mode-string (delete '("" keycast-mode-line "  ") global-mode-string))
      ))

  (dolist (input '(self-insert-command
                   org-self-insert-command))
    (add-to-list 'keycast-substitute-alist `(,input "." "Typingâ€¦")))

  (dolist (event '(mouse-event-p
                   mouse-movement-p
                   mwheel-scroll))
    (add-to-list 'keycast-substitute-alist `(,event nil)))

  (setq keycast-log-format "%-20K%C\n")
  (setq keycast-log-frame-alist
        '((minibuffer . nil)))
  (setq keycast-log-newest-first t)
  )
#+END_SRC
** dashboard è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package dashboard
  :ensure t
  :config
  (setq dashboard-banner-logo-title "Welcom to Emacs")
  ;;(setq dashboard-projects-backend 'projectile)
  (setq dashboard-startup-banner 'official)
  (setq dashboard-items '((recents . 5)
			  (bookmarks . 5)
			  (projects . 10)))
  (dashboard-setup-startup-hook))
#+END_SRC
** shackle çª—å£è¡Œä¸ºæ§åˆ¶
+ é€šè¿‡ [[https://depp.brause.cc/shackle/][shackle]] æ’ä»¶è‡ªå®šä¹‰çª—å£çš„å¼¹å‡ºè¡Œä¸ºï¼ŒåŒ…æ‹¬æ–¹å‘ã€å¤§å°ã€å¼¹å‡ºæ–¹å¼ç­‰
#+BEGIN_QUOTE
å…¶ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯ shackle-rules è¿™ä¸ªå˜é‡çš„é…ç½®ï¼Œè¿™ä¸ªå˜é‡çš„é…ç½®ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªæ–¹é¢ï¼š

CONDITION
    æ¡ä»¶ï¼Œå³è¿™ä¸€æ¡è§„åˆ™é€‚ç”¨äºæ»¡è¶³ä»€ä¹ˆæ ·çš„æ¡ä»¶æ‰ç”Ÿæ•ˆã€‚è¿™ä¸ªæ¡ä»¶å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ˜¯æ¨¡å¼ï¼Œå¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œ *eshell* å°±æ˜¯åŒ¹é…åˆ°ç¼“å†²åŒºåå­—æ˜¯ *eshell* æ—¶ç”Ÿæ•ˆã€‚
:select
    æ§åˆ¶å¼¹å‡º window åæ˜¯å¦é€‰ä¸­
:inhibit-window-quit
    æŒ‰â€œqâ€é€€å‡ºæ—¶ï¼Œä¸åˆ é™¤è¿™ä¸ªç¼“å†²åŒº
:size
    0-1ä¹‹é—´çš„æ•°ï¼Œæ§åˆ¶ window çš„ç™¾åˆ†æ¯”å®½åº¦æˆ–é«˜åº¦ï¼Œå¦‚0.5å°±æ˜¯æŒ‡ä¸€åŠçš„å®½åº¦æˆ–é«˜åº¦
:align
    å¼¹å‡ºçš„ window å¾€å“ªé‡Œçœ‹é½ï¼Œå¯ä»¥å–å€¼ä¸º t, â€™left, â€˜right, â€˜below, â€˜above
:other
    å¦‚æœå½“å‰ frame æœ‰å¤šä¸ª windowï¼Œæ˜¯å¦å¤ç”¨å¦å¤–ä¸€ä¸ª window
:popup
    å¼¹å‡ºä¸€ä¸ªæ–°çš„ windowï¼Œè€Œä¸æ˜¯å¤ç”¨å½“å‰ window
:same
    ä¸å¼¹å‡º windowï¼Œå¤ç”¨å½“å‰ window
:ignore
    ç¦æ­¢æ˜¾ç¤ºè¯¥çª—å£
#+END_QUOTE
#+BEGIN_SRC emacs-lisp
(use-package shackle
  :ensure t
  :hook (after-init . shackle-mode)
  :init
  (setq shackle-lighter "")
  (setq shackle-select-reused-windows nil) ; default nil
  (setq shackle-default-alignment 'below)  ; default below
  (setq shackle-rules
        ;; CONDITION(:regexp)            :select     :inhibit-window-quit   :size+:align|:other     :same|:popup
        '((compilation-mode              :ignore t)
          ("\\*Async Shell.*\\*" :regexp t :ignore t)
          ("\\*corfu.*\\*"       :regexp t :ignore t)
          ("*eshell*"                    :select t                          :size 0.4  :align t     :popup t)
          (helpful-mode                  :select t                          :size 0.6  :align right :popup t)
          ("*Messages*"                  :select t                          :size 0.4  :align t     :popup t)
          ("*Calendar*"                  :select t                          :size 0.3  :align t     :popup t)
          ("*info*"                      :select t                                                  :same t)
          (magit-status-mode             :select t   :inhibit-window-quit t                         :same t)
          (magit-log-mode                :select t   :inhibit-window-quit t                         :same t)
          ))
  )
#+END_SRC
** popper çª—å£å¼¹å‡ºè¡Œä¸ºç®¡ç†
+ [[https://github.com/karthink/popper][popper]] å¯ä»¥æ§åˆ¶çª—å£çš„å¼¹å‡ºè¡Œä¸ºï¼Œä¸ [[https://depp.brause.cc/shackle/][shackle]] ä¸€èµ·é…åˆä½¿ç”¨
+ å·¦ä¸‹è§’æ˜¾ç¤ºäº† =POP= çš„å­—æ ·ï¼Œæˆ‘ä»¬æŒ‰ä¸‹ =M-`= å¯ä»¥ä¸€é”®å…³é—­/æ‰“å¼€è¿™ä¸ªçª—å£
#+BEGIN_SRC emacs-lisp
(use-package popper
  :ensure t
  :bind (("M-`"     . popper-toggle-latest)
         ("M-<tab>" . popper-cycle)
         ("M-\\"    . popper-toggle-type)
         )
  :init
  (setq popper-reference-buffers
        '("\\*Messages\\*"
          "\\*Async Shell Command\\*"
          help-mode
          helpful-mode
          occur-mode
          pass-view-mode
          "^\\*eshell.*\\*$" eshell-mode ;; eshell as a popup
          "^\\*shell.*\\*$"  shell-mode  ;; shell as a popup
          ("\\*corfu\\*" . hide)
          (compilation-mode . hide)
          ;; derived from `fundamental-mode' and fewer than 10 lines will be considered a popup
          (lambda (buf) (with-current-buffer buf
                          (and (derived-mode-p 'fundamental-mode)
                               (< (count-lines (point-min) (point-max))
                                  10))))
          )
        )
  (popper-mode +1)
  (popper-echo-mode +1)
  :config
  ;; group by project.el, projectile, directory or perspective
  (setq popper-group-function nil)

  ;; pop in child frame or not
  (setq popper-display-function #'display-buffer-in-child-frame)

  ;; use `shackle.el' to control popup
  (setq popper-display-control nil)
  )
#+END_SRC
** winner çª—å£å¸ƒå±€æ¢å¤
+ é€šè¿‡ winner-undo å’Œ winner-redo å‘½ä»¤æ¢å¤æˆ–é‡åšå½“å‰çš„çª—å£å¸ƒå±€ã€‚
+ é€šè¿‡ =C-x 1= æœ€å¤§åŒ–æŸä¸ªçª—å£åï¼Œä½¿ç”¨ =winner-undo= æ¢å¤å¸ƒå±€
#+BEGIN_SRC emacs-lisp
(use-package winner
  :ensure nil
  :hook (after-init . winner-mode)
  :commands (winner-undo winner-redo)
  :config
  (setq winner-boring-buffers
        '("*Completions*"
          "*Compile-Log*"
          "*inferior-lisp*"
          "*Fuzzy Completions*"
          "*Apropos*"
          "*Help*"
          "*cvs*"
          "*Buffer List*"
          "*Ibuffer*"
          "*esh command on file*"))
  )
#+END_SRC
** init-ui.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp

(provide 'init-ui)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-ui.el ends here
#+END_SRC

* init-base.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-base.el :mkdirp yes
:END:
** init-base.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-base.el --- Basical settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** å…³é—­è­¦å‘Š
#+BEGIN_SRC emacs-lisp
(setq warning-minimum-level :error)
#+END_SRC
** no-litteringè®©é…ç½®ç›®å½•å˜ç®€æ´
#+BEGIN_SRC emacs-lisp
(use-package no-littering
  :ensure t)
#+END_SRC
** savehistè®°ä½mini-bufferå†å²
#+BEGIN_SRC emacs-lisp
(use-package savehist
  :ensure nil
  :hook (after-init . savehist-mode)
  :config
  ;; Allow commands in minibuffers, will affect `dired-do-dired-do-find-regexp-and-replace' command:
  (setq enable-recursive-minibuffers t)
  (setq history-length 1000)
  (setq savehist-additional-variables '(mark-ring
                                        global-mark-ring
                                        search-ring
                                        regexp-search-ring
                                        extended-command-history))
  (setq savehist-autosave-interval 300))
#+END_SRC
** saveplaceè®°ä½æ¯ä¸ªæ–‡ä»¶çš„å…‰æ ‡ä½ç½®
+ è‡ªåŠ¨è®°ä½æ¯ä¸ªæ–‡ä»¶æœ€åä¸€æ¬¡è®¿é—®çš„å…‰æ ‡ä½ç½®
#+BEGIN_SRC emacs-lisp
(use-package saveplace
  :ensure nil
  :hook (after-init . save-place-mode))
#+END_SRC
** recentfè®°ä½æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶å†å²
#+BEGIN_SRC emacs-lisp
(use-package recentf
  :ensure nil
  :defines no-littering-etc-directory no-littering-var-directory
  :hook (after-init . recentf-mode)
  :custom
  (recentf-max-saved-items 300)
  (recentf-auto-cleanup 'never)
  ;; `recentf-add-file' will apply handlers first, then call `string-prefix-p'
  ;; to check if it can be pushed to recentf list.
  (recentf-filename-handlers '(abbreviate-file-name))
  (recentf-exclude `(,@(cl-loop for f in `(,package-user-dir
                                           ,no-littering-var-directory
                                           ,no-littering-etc-directory)
                                collect (abbreviate-file-name f))
                     ;; Folders on MacOS start
                     "^/private/tmp/"
                     "^/var/folders/"
                     ;; Folders on MacOS end
                     ".cache"
                     ".cask"
                     ".elfeed"
                     "elfeed"
                     "bookmarks"
                     "cache"
                     "ido.*"
                     "persp-confs"
                     "recentf"
                     "undo-tree-hist"
                     "url"
                     "^/tmp/"
                     "/ssh\\(x\\)?:"
                     "/su\\(do\\)?:"
                     "^/usr/include/"
                     "/TAGS\\'"
                     "COMMIT_EDITMSG\\'")))
#+END_SRC
** undo-tree
- æ’¤é”€è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package undo-tree
  :ensure t
  :hook (after-init . global-undo-tree-mode)
  :config
  ;; don't save undo history to local files
  (setq undo-tree-auto-save-history nil)
  )
#+END_SRC
** auto-saveè‡ªåŠ¨ä¿å­˜
+ [[https://github.com/manateelazycat/auto-save][auto-save]] æ˜¯ [[https://manateelazycat.github.io/][manateeLazyCat]] å¼€å‘çš„è‡ªåŠ¨ä¿å­˜æ’ä»¶
#+BEGIN_SRC emacs-lisp
;; auto-save @
(add-to-list 'load-path "~/.emacs.d/site-lisp/auto-save/")
(require 'auto-save)
(auto-save-enable)
; quick save
(setq auto-save-silent t)
; automatically delete spaces at the end of the line when saving
;; (setq auto-save-delete-trailing-whitespace t)
#+END_SRC
** cruxç³»ç»Ÿå¢å¼º
+ [[https://github.com/bbatsov/crux][crux]] æä¾›ä¸€ç³»åˆ—çš„å¢å¼ºï¼Œå¦‚ç§»åŠ¨å¢å¼ºã€åˆ é™¤å¢å¼ºç­‰ã€‚
#+BEGIN_SRC emacs-lisp
;; crux
(use-package crux
  :ensure t
  :bind (("C-a" . crux-move-beginning-of-line)
         ("C-x 4 t" . crux-transpose-windows)
         ("C-x K" . crux-kill-other-buffers)
         ("C-k" . crux-smart-kill-line)
         ("C-c r" . crux-rename-file-and-buffer)
         ("C-x DEL" . crux-kill-line-backwards))
  :config
  (crux-with-region-or-buffer indent-region)
  (crux-with-region-or-buffer untabify)
  (crux-with-region-or-point-to-eol kill-ring-save)
  (defalias 'rename-file-and-buffer #'crux-rename-file-and-buffer))
#+END_SRC
** ivyå¢å¼º
+ å‚è€ƒ [[https://zhuanlan.zhihu.com/p/441612281][ä¸“ä¸šEmacså…¥é—¨ï¼ˆäº”ï¼‰ï¼šæ’ä»¶ç¯‡â€”â€”åŠŸèƒ½ä¼˜åŒ–ç±»]]
#+BEGIN_SRC emacs-lisp
(use-package counsel
  :ensure t)

(use-package ivy
  :ensure t
  :init
  (ivy-mode 1)
  (counsel-mode 1)
  :config
  (setq ivy-use-virtual-buffers t)
  (setq search-default-mode #'char-fold-to-regexp)
  (setq ivy-count-format "(%d/%d) ")
  :bind
  (("C-s" . 'swiper)
   ("C-x b" . 'ivy-switch-buffer)
   ("C-c v" . 'ivy-push-view)
   ("C-c s" . 'ivy-switch-view)
   ("C-c V" . 'ivy-pop-view)
   ("C-x C-@" . 'counsel-mark-ring)
   ("C-x C-SPC" . 'counsel-mark-ring)
   :map minibuffer-local-map
   ("C-r" . counsel-minibuffer-history)))
#+END_SRC
** ace-windowå¤šçª—å£åˆ‡æ¢
#+BEGIN_SRC emacs-lisp
;; ace-window
(use-package ace-window
  :ensure t
  :bind (("C-x o" . 'ace-window)))
#+END_SRC
** init-base.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-base)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-base.el ends here
#+END_SRC
* init-dired.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-dired.el :mkdirp yes
:END:
** init-dired.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-dired.el --- Dired settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** dired åŸºç¡€é…ç½®
#+BEGIN_SRC emacs-lisp
(use-package dired
  :ensure nil
  :bind (:map dired-mode-map
              ("C-<return>" . xah-open-in-external-app)
              ("W" . dired-copy-path)
              )
  :config
  ;; Enable the disabled dired commands
  (put 'dired-find-alternate-file 'disabled nil)

  ;; open files via external program based on file types, See:
  ;; https://emacs.stackexchange.com/questions/3105/how-to-use-an-external-program-as-the-default-way-to-open-pdfs-from-emacs
  (defun xdg-open (filename)
    (interactive "fFilename: ")
    (let ((process-connection-type))
      (start-process "" nil (cond ((eq system-type 'gnu/linux) "xdg-open")
                                  ((eq system-type 'darwin) "open")
                                  ((eq system-type 'windows-nt) "start")
                                  (t "")) (expand-file-name filename))))
  ;; open files via external program when using find-file
  (defun find-file-auto (orig-fun &rest args)
    (let ((filename (car args)))
      (if (cl-find-if
           (lambda (regexp) (string-match regexp filename))
           '(
             ;; "\\.html?\\'"
             "\\.xlsx?\\'"
             "\\.pptx?\\'"
             "\\.docx?\\'"
             "\\.mp4\\'"
             "\\.app\\'"
             ))
          (xdg-open filename)
        (apply orig-fun args))))
  (advice-add 'find-file :around 'find-file-auto)

  (defun dired-copy-path ()
    "In dired, copy file path to kill-buffer.
At 2nd time it copy current directory to kill-buffer."
    (interactive)
    (let (path)
      (setq path (dired-file-name-at-point))
      (if (string= path (current-kill 0 1)) (setq path (dired-current-directory)))
      (message path)
      (kill-new path)))

  (defun xah-open-in-external-app (&optional @fname)
    "Open the current file or dired marked files in external app.
The app is chosen from your OS's preference.

When called in emacs lisp, if @fname is given, open that.

URL `http://ergoemacs.org/emacs/emacs_dired_open_file_in_ext_apps.html'
Version 2019-11-04"
    (interactive)
    (let* (
           ($file-list
            (if @fname
                (progn (list @fname))
              (if (or (string-equal major-mode "dired-mode")
                      (string-equal major-mode "dirvish-mode"))
                  (dired-get-marked-files)
                (list (buffer-file-name)))))
           ($do-it-p (if (<= (length $file-list) 5)
                         t
                       (y-or-n-p "Open more than 5 files? "))))
      (when $do-it-p
        (cond
         ((string-equal system-type "windows-nt")
          (mapc
           (lambda ($fpath)
             (w32-shell-execute "open" $fpath)) $file-list))
         ((string-equal system-type "darwin")
          (mapc
           (lambda ($fpath)
             (shell-command
              (concat "open " (shell-quote-argument $fpath))))  $file-list))
         ((string-equal system-type "gnu/linux")
          (mapc
           (lambda ($fpath) (let ((process-connection-type nil))
                              (start-process "" nil "xdg-open" $fpath))) $file-list))))))
  :custom
  ;; (dired-recursive-deletes 'always)
  (delete-by-moving-to-trash t)
  (dired-dwim-target t)
  (dired-bind-vm nil)
  (dired-bind-man nil)
  (dired-bind-info nil)
  (dired-auto-revert-buffer t)
  (dired-hide-details-hide-symlink-targets nil)
  (dired-kill-when-opening-new-dired-buffer t)
  (dired-listing-switches "-AFhlv"))

(use-package dired-aux
  :ensure nil
  :bind (:map dired-mode-map
              ("C-c +" . dired-create-empty-file))
  :config
  ;; with the help of `evil-collection', P is bound to `dired-do-print'.
  (define-advice dired-do-print (:override (&optional _))
    "Show/hide dotfiles."
    (interactive)
    (if (or (not (boundp 'dired-dotfiles-show-p)) dired-dotfiles-show-p)
        (progn
          (setq-local dired-dotfiles-show-p nil)
          (dired-mark-files-regexp "^\\.")
          (dired-do-kill-lines))
      (revert-buffer)
      (setq-local dired-dotfiles-show-p t)))
  :custom
  (dired-isearch-filenames 'dwim)
  (dired-create-destination-dirs 'ask)
  (dired-vc-rename-file t))

(use-package dired-x
  :ensure nil
  :hook (dired-mode . dired-omit-mode)
  :init
  (setq dired-guess-shell-alist-user `((,(rx "."
                                             (or
                                              ;; Videos
                                              "mp4" "avi" "mkv" "flv" "ogv" "ogg" "mov"
                                              ;; Music
                                              "wav" "mp3" "flac"
                                              ;; Images
                                              "jpg" "jpeg" "png" "gif" "xpm" "svg" "bmp"
                                              ;; Docs
                                              "pdf" "md" "djvu" "ps" "eps" "doc" "docx" "xls" "xlsx" "ppt" "pptx")
                                             string-end)
                                        ,(cond ((eq system-type 'gnu/linux) "xdg-open")
                                               ((eq system-type 'darwin) "open")
                                               ((eq system-type 'windows-nt) "start")
                                               (t "")))))
  :custom
  (dired-omit-verbose nil)
  (dired-omit-files (rx string-start
                        (or ".DS_Store"
                            ".cache"
                            ".vscode"
                            ".ccls-cache" ".clangd")
                        string-end))
  ;; Dont prompt about killing buffer visiting delete file
  (dired-clean-confirm-killing-deleted-buffers nil)
  )
#+END_SRC
** diredfl å¤šå½©ç¾åŒ–
+ é»˜è®¤çš„ Dired åªæœ‰ä¸¤ç§é¢œè‰²ä»¥åŒºåˆ†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ [[https://github.com/purcell/diredfl][diredfl]] æ’ä»¶è®©Diredå˜å¾—å¤šå½©
#+BEGIN_SRC emacs-lisp
(use-package diredfl
  :ensure t
  :hook (dired-mode . diredfl-mode))
#+END_SRC
** all-the-icons-dired å›¾æ ‡ç¾åŒ–
+ ä½¿ç”¨ [[https://github.com/jtbm37/all-the-icons-dired][all-the-icons-dired]] æ’ä»¶ä¸ºDiredæ·»åŠ å¥½çœ‹çš„å›¾æ ‡
#+BEGIN_SRC emacs-lisp
(use-package all-the-icons-dired
  :ensure t
  :hook (dired-mode . all-the-icons-dired-mode)
  )
#+END_SRC
** init-dired.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-dired)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dired.el ends here
#+END_SRC
* init-edit.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-edit.el :mkdirp yes
:END:
** init-edit.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-edit.el --- Editing settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** Emacså¤‡ä»½è®¾ç½®
+ ä¸ä½¿ç”¨Emacsçš„è‡ªåŠ¨å¤‡ä»½è®¾ç½®ã€‚
#+BEGIN_SRC emacs-lisp
(setq make-backup-files nil)                                  ; ä¸è‡ªåŠ¨å¤‡ä»½
(setq auto-save-default nil)                                  ; ä¸ä½¿ç”¨Emacsè‡ªå¸¦çš„è‡ªåŠ¨ä¿å­˜
#+END_SRC
** è§£é™¤ä¸€äº›ä¸å¸¸ç”¨çš„å¿«æ·é”®
+ å°†ä¸€äº›ä¸å¸¸ç”¨çš„å¿«æ·é”®è§£é™¤ï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚
#+BEGIN_SRC emacs-lisp
;; è§£é™¤ä¸å¸¸ç”¨çš„å¿«æ·é”®å®šä¹‰
(global-set-key (kbd "C-z") nil)
(global-set-key (kbd "s-q") nil)
(global-set-key (kbd "M-z") nil)
(global-set-key (kbd "M-m") nil)
(global-set-key (kbd "C-x C-z") nil)
(global-set-key [mouse-2] nil)
#+END_SRC
** delselé€‰æ‹©æ–‡æœ¬è¾“å…¥æ—¶ç›´æ¥æ›¿æ¢
+ Emacsé»˜è®¤é€‰æ‹©æ–‡æœ¬åç›´æ¥è¾“å…¥ï¼Œæ˜¯ä¸ä¼šç›´æ¥åˆ é™¤æ‰€é€‰æ‹©çš„æ–‡æœ¬è¿›è¡Œæ›¿æ¢çš„ã€‚é€šè¿‡å†…ç½®çš„ delsel æ’ä»¶æ¥å®ç°è¿™ä¸ªè¡Œä¸ºã€‚
#+BEGIN_SRC emacs-lisp
;; Directly modify when selecting text
(use-package delsel
  :ensure nil
  :hook (after-init . delete-selection-mode))
#+END_SRC
** å¯¹Orgæ–‡ä»¶è¿›è¡Œè‡ªåŠ¨tangle
** init-edit.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
;; (message "init-base configuration: %.2fs"
;;          (float-time (time-subtract (current-time) my/init-base-start-time)))

(provide 'init-edit)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-edit.el ends here
#+END_SRC
* init-org.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-org.el :mkdirp yes
:END:
** init-org.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-org.el --- Org mode settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** Org mode åŸºæœ¬é…ç½®
#+BEGIN_SRC emacs-lisp
  ;; org
  (use-package org
    :defer t ;; å»¶è¿ŸåŠ è½½
    :ensure nil
    :mode ("\\.org\\'" . org-mode)
    :hook ((org-mode . visual-line-mode)
           (org-mode . my/org-prettify-symbols))
    :commands (org-find-exact-headline-in-buffer org-set-tags)
    :custom-face
    ;; è®¾ç½®Org modeæ ‡é¢˜ä»¥åŠæ¯çº§æ ‡é¢˜è¡Œçš„å¤§å°
    (org-document-title ((t (:height 1.75 :weight bold))))
    (org-level-1 ((t (:height 1.2 :weight bold))))
    (org-level-2 ((t (:height 1.15 :weight bold))))
    (org-level-3 ((t (:height 1.1 :weight bold))))
    (org-level-4 ((t (:height 1.05 :weight bold))))
    (org-level-5 ((t (:height 1.0 :weight bold))))
    (org-level-6 ((t (:height 1.0 :weight bold))))
    (org-level-7 ((t (:height 1.0 :weight bold))))
    (org-level-8 ((t (:height 1.0 :weight bold))))
    (org-level-9 ((t (:height 1.0 :weight bold))))
    ;; è®¾ç½®ä»£ç å—ç”¨ä¸Šä¸‹è¾¹çº¿åŒ…è£¹
    (org-block-begin-line ((t (:underline t :background unspecified))))
    (org-block-end-line ((t (:overline t :underline nil :background unspecified))))
    :config
    ;; æ‰“å¼€ cdlatex
    (add-hook 'org-mode-hook #'org-cdlatex-mode)
    (add-hook 'org-mode-hook (lambda () (setq truncate-lines nil)))
    ;; ================================
    ;; åœ¨org modeé‡Œç¾åŒ–å­—ç¬¦ä¸²
    ;; https://symbl.cc/cn/
    ;; ================================
    (defun my/org-prettify-symbols ()
      (setq prettify-symbols-alist
            (mapcan (lambda (x) (list x (cons (upcase (car x)) (cdr x))))
                    '(
                      ("[ ]"              . 9744)         ; â˜
                      ("[X]"              . 9745)         ; â˜‘
                      ("[-]"              . 8863)         ; âŠŸ
                      ("#+begin_src"      . 9998)         ; âœ
                      ("#+end_src"        . 9633)         ; â–¡
                      ("#+begin_example"  . 20363)        ; ä¾‹
                      ("#+end_example"    . 20363)        ; ä¾‹
                      ("#+results:"       . 9776)         ; â˜°
                      ("#+attr_latex:"    . 127259)       ; ğŸ„›
                      ("#+attr_html:"     . 127255)       ; ğŸ„—
                      ("#+attr_org:"      . 127262)       ; ğŸ„
                      ("#+name:"          . 127261)       ; ğŸ„
                      ("#+caption:"       . 127250)       ; ğŸ„’
					  ("#+date:"          . 128197)       ; ğŸ“…
					  ("#+author:"        . 128214)       ; ğŸ“–
					  ("#+setupfile:"     . 128221)       ; ğŸ“
					  ("#+email:"         . 128231)       ; ğŸ“§
                      ("#+startup:"       . 10034)        ; âœ²
                      ("#+options:"       . 9881)         ; âš™
                      ("#+title:"         . 39064)        ; é¢˜
                      ("#+subtitle:"      . 21103)        ; å‰¯
                      ("#+downloaded:"    . 8650)         ; â‡Š
                      ("#+language:"      . 25991)        ; æ–‡
                      ("#+begin_quote"    . 187)          ; Â»
                      ("#+end_quote"      . 171)          ; Â«
                      ("#+begin_results"  . 8943)         ; â‹¯
                      ("#+end_results"    . 8943)         ; â‹¯
                      )))
      (setq prettify-symbols-unprettify-at-point t)
      (prettify-symbols-mode 1))

    ;; æå‡latexé¢„è§ˆçš„å›¾ç‰‡æ¸…æ™°åº¦
    (plist-put org-format-latex-options :scale 1.8)

    ;; è®¾ç½®æ ‡é¢˜è¡Œä¹‹é—´æ€»æ˜¯æœ‰ç©ºæ ¼ï¼›åˆ—è¡¨ä¹‹é—´æ ¹æ®æƒ…å†µè‡ªåŠ¨åŠ ç©ºæ ¼
    (setq org-blank-before-new-entry '((heading . t)
                                       (plain-list-item . auto)
                                       ))

    ;; ======================================
    ;; è®¾ç½®æ‰“å¼€Org linksçš„ç¨‹åº
    ;; ======================================
    (defun my-func/open-and-play-gif-image (file &optional link)
      "Open and play GIF image `FILE' in Emacs buffer.

  Optional for Org-mode file: `LINK'."
      (let ((gif-image (create-image file))
            (tmp-buf (get-buffer-create "*Org-mode GIF image animation*")))
        (switch-to-buffer tmp-buf)
        (erase-buffer)
        (insert-image gif-image)
        (image-animate gif-image nil t)
        (local-set-key (kbd "q") 'bury-buffer)
        ))
    (setq org-file-apps '(("\\.png\\'"     . default)
                          (auto-mode       . emacs)
                          (directory       . emacs)
                          ("\\.mm\\'"      . default)
                          ("\\.x?html?\\'" . default)
                          ("\\.pdf\\'"     . emacs)
                          ("\\.md\\'"      . emacs)
                          ("\\.gif\\'"     . my-func/open-and-play-gif-image)
                          ("\\.xlsx\\'"    . default)
                          ("\\.svg\\'"     . default)
                          ("\\.pptx\\'"    . default)
                          ("\\.docx\\'"    . default)))

    :custom
    ;; è®¾ç½®Org modeçš„ç›®å½•
    (org-directory "~/org")
    ;; è®¾ç½®ç¬”è®°çš„é»˜è®¤å­˜å‚¨ä½ç½®
    (org-default-notes-file (expand-file-name "capture.org" org-directory))
    ;; å¯ç”¨ä¸€äº›å­æ¨¡å—
    (org-modules '(ol-bibtex ol-gnus ol-info ol-eww org-habit org-protocol))
    ;; åœ¨æŒ‰M-RETæ—¶ï¼Œæ˜¯å¦æ ¹æ®å…‰æ ‡æ‰€åœ¨çš„ä½ç½®åˆ†è¡Œï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ˜¯
    ;; (org-M-RET-may-split-line '((default . nil)))
    ;; ä¸€äº›Org modeè‡ªå¸¦çš„ç¾åŒ–è®¾ç½®
    ;; æ ‡é¢˜è¡Œç¾åŒ–
    (org-fontify-whole-heading-line t)
    ;; è®¾ç½®æ ‡é¢˜è¡ŒæŠ˜å ç¬¦å·
    (org-ellipsis " â–¾")
    ;; åœ¨æ´»åŠ¨åŒºåŸŸå†…çš„æ‰€æœ‰æ ‡é¢˜æ æ‰§è¡ŒæŸäº›å‘½ä»¤
    (org-loop-over-headlines-in-active-region t)
    ;; TODOæ ‡ç­¾ç¾åŒ–
    (org-fontify-todo-headline t)
    ;; DONEæ ‡ç­¾ç¾åŒ–
    (org-fontify-done-headline t)
    ;; å¼•ç”¨å—ç¾åŒ–
    (org-fontify-quote-and-verse-blocks t)
    ;; éšè—å®æ ‡è®°
    (org-hide-macro-markers t)
    ;; éšè—å¼ºè°ƒæ ‡ç­¾, å¦‚=,~,*,_ç­‰, ä¸org-appearé…åˆ
    (org-hide-emphasis-markers t)
    ;; ä»¥UTF-8æ˜¾ç¤ºï¼ŒLaTeX ä»£ç çš„ prettify
    (org-pretty-entities t)
    ;; é«˜äº® LaTeX è¯­æ³•
    (org-highlight-latex-and-related '(native latex script entities))
    ;; ä¸éšè— LaTeX çš„ä¸Šä¸‹æ ‡ï¼Œä¾¿äºç†è§£
    (org-pretty-entities-include-sub-superscripts nil)
    ;; å¢å¤§å…¬å¼é¢„è§ˆçš„å›¾ç‰‡å¤§å°
    (org-format-latex-options '(:foreground default :background default :scale 1.8 :html-foreground "Black" :html-background "Transparent" :html-scale 1.0 :matchers ("begin" "$1" "$$" "\\(" "\\[")))
    ;; æ˜¯å¦éšè—æ ‡é¢˜æ çš„å‰ç½®æ˜Ÿå·ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡org-modernæ¥éšè—
    ;; (org-hide-leading-stars t)
    ;; å½“å¯ç”¨ç¼©è¿›æ¨¡å¼æ—¶è‡ªåŠ¨éšè—å‰ç½®æ˜Ÿå·
    (org-indent-mode-turns-on-hiding-stars t)
    ;; è‡ªåŠ¨å¯ç”¨ç¼©è¿›
    (org-startup-indented nil)
    ;; æ ¹æ®æ ‡é¢˜æ è‡ªåŠ¨ç¼©è¿›æ–‡æœ¬
    (org-adapt-indentation nil)
    ;; è‡ªåŠ¨æ˜¾ç¤ºå›¾ç‰‡
    (org-startup-with-inline-images t)
    ;; é»˜è®¤ä»¥Overviewçš„æ¨¡å¼å±•ç¤ºæ ‡é¢˜è¡Œ
    (org-startup-folded 'overview)
    ;; å…è®¸å­—æ¯åˆ—è¡¨
    (org-list-allow-alphabetical t)
    ;; åˆ—è¡¨çš„ä¸‹ä¸€çº§è®¾ç½®
    (org-list-demote-modify-bullet '(
                                     ("-"  . "+")
                                     ("+"  . "1.")
                                     ("1." . "a.")
                                     ))
    ;; ç¼–è¾‘æ—¶æ£€æŸ¥æ˜¯å¦åœ¨æŠ˜å çš„ä¸å¯è§åŒºåŸŸ
    (org-fold-catch-invisible-edits 'smart)
    ;; åœ¨å½“å‰ä½ç½®æ’å…¥æ–°æ ‡é¢˜è¡Œè¿˜æ˜¯åœ¨å½“å‰æ ‡é¢˜è¡Œåæ’å…¥ï¼Œè¿™é‡Œè®¾ç½®ä¸ºå½“å‰ä½ç½®
    (org-insert-heading-respect-content nil)
    ;; è®¾ç½®å›¾ç‰‡çš„æœ€å¤§å®½åº¦ï¼Œå¦‚æœæœ‰imagemagickæ”¯æŒå°†ä¼šæ”¹å˜å›¾ç‰‡å®é™…å®½åº¦
    ;; å››ç§è®¾ç½®æ–¹æ³•ï¼š(1080), 1080, t, nil
    (org-image-actual-width nil)
    ;; imenuçš„æœ€å¤§æ·±åº¦ï¼Œé»˜è®¤ä¸º2
    (org-imenu-depth 4)
    ;; å›è½¦è¦ä¸è¦è§¦å‘é“¾æ¥ï¼Œè¿™é‡Œè®¾ç½®ä¸è§¦å‘
    (org-return-follows-link nil)
    ;; ä¸Šæ ‡^ä¸‹æ ‡_æ˜¯å¦éœ€è¦ç‰¹æ®Šå­—ç¬¦åŒ…è£¹ï¼Œè¿™é‡Œè®¾ç½®éœ€è¦ç”¨å¤§æ‹¬å·åŒ…è£¹
    (org-use-sub-superscripts '{})
    ;; å¤åˆ¶ç²˜è´´æ ‡é¢˜è¡Œçš„æ—¶å€™åˆ é™¤id
    (org-clone-delete-id t)
    ;; ç²˜è´´æ—¶è°ƒæ•´æ ‡é¢˜è¡Œçš„çº§åˆ«
    (org-yank-adjusted-subtrees t)

    ;; TOODçš„å…³é”®è¯è®¾ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„ç»„
    (org-todo-keywords '((sequence "TODO(t)" "HOLD(h!)" "WIP(i!)" "WAIT(w!)" "|" "DONE(d!)" "CANCELLED(c@/!)")
                         (sequence "REPORT(r)" "BUG(b)" "KNOWNCAUSE(k)" "|" "FIXED(f!)")))
    ;; TODOå…³é”®è¯çš„æ ·å¼è®¾ç½®
    (org-todo-keyword-faces '(("TODO"       :foreground "#7c7c75" :weight bold)
                              ("HOLD"       :foreground "#feb24c" :weight bold)
                              ("WIP"        :foreground "#0098dd" :weight bold)
                              ("WAIT"       :foreground "#9f7efe" :weight bold)
                              ("DONE"       :foreground "#50a14f" :weight bold)
                              ("CANCELLED"  :foreground "#ff6480" :weight bold)
                              ("REPORT"     :foreground "magenta" :weight bold)
                              ("BUG"        :foreground "red"     :weight bold)
                              ("KNOWNCAUSE" :foreground "yellow"  :weight bold)
                              ("FIXED"      :foreground "green"   :weight bold)))
    ;; å½“æ ‡é¢˜è¡ŒçŠ¶æ€å˜åŒ–æ—¶æ ‡ç­¾åŒæ­¥å‘ç”Ÿçš„å˜åŒ–
    ;; Moving a task to CANCELLED adds a CANCELLED tag
    ;; Moving a task to WAIT adds a WAIT tag
    ;; Moving a task to HOLD adds WAIT and HOLD tags
    ;; Moving a task to a done state removes WAIT and HOLD tags
    ;; Moving a task to TODO removes WAIT, CANCELLED, and HOLD tags
    ;; Moving a task to DONE removes WAIT, CANCELLED, and HOLD tags
    (org-todo-state-tags-triggers
     (quote (("CANCELLED" ("CANCELLED" . t))
             ("WAIT" ("WAIT" . t))
             ("HOLD" ("WAIT") ("HOLD" . t))
             (done ("WAIT") ("HOLD"))
             ("TODO" ("WAIT") ("CANCELLED") ("HOLD"))
             ("DONE" ("WAIT") ("CANCELLED") ("HOLD")))))
    ;; ä½¿ç”¨ä¸“å®¶æ¨¡å¼é€‰æ‹©æ ‡é¢˜æ çŠ¶æ€
    (org-use-fast-todo-selection 'expert)
    ;; çˆ¶å­æ ‡é¢˜æ çŠ¶æ€æœ‰ä¾èµ–
    (org-enforce-todo-dependencies t)
    ;; æ ‡é¢˜æ å’Œä»»åŠ¡å¤é€‰æ¡†æœ‰ä¾èµ–
    (org-enforce-todo-checkbox-dependencies t)
    ;; ä¼˜å…ˆçº§æ ·å¼è®¾ç½®
    (org-priority-faces '((?A :foreground "red")
                          (?B :foreground "orange")
                          (?C :foreground "yellow")))
    ;; æ ‡é¢˜è¡Œå…¨å±€å±æ€§è®¾ç½®
    (org-global-properties '(("EFFORT_ALL" . "0:15 0:30 0:45 1:00 2:00 3:00 4:00 5:00 6:00 7:00 8:00")
                             ("APPT_WARNTIME_ALL" . "0 5 10 15 20 25 30 45 60")
                             ("RISK_ALL" . "Low Medium High")
                             ("STYLE_ALL" . "habit")))
    ;; Org columnsçš„é»˜è®¤æ ¼å¼
    (org-columns-default-format "%25ITEM %TODO %SCHEDULED %DEADLINE %3PRIORITY %TAGS %CLOCKSUM %EFFORT{:}")
    ;; å½“çŠ¶æ€ä»DONEæ”¹æˆå…¶ä»–çŠ¶æ€æ—¶ï¼Œç§»é™¤ CLOSED: [timestamp]
    (org-closed-keep-when-no-todo t)
    ;; DONEæ—¶åŠ ä¸Šæ—¶é—´æˆ³
    (org-log-done 'time)
    ;; é‡å¤æ‰§è¡Œæ—¶åŠ ä¸Šæ—¶é—´æˆ³
    (org-log-repeat 'time)
    ;; Deadlineä¿®æ”¹æ—¶åŠ ä¸Šä¸€æ¡è®°å½•
    (org-log-redeadline 'note)
    ;; Scheduleä¿®æ”¹æ—¶åŠ ä¸Šä¸€æ¡è®°å½•
    (org-log-reschedule 'note)
    ;; ä»¥æŠ½å±‰çš„æ–¹å¼è®°å½•
    (org-log-into-drawer t)
    ;; ç´§æ¥ç€æ ‡é¢˜è¡Œæˆ–è€…è®¡åˆ’/æˆªæ­¢æ—¶é—´æˆ³ååŠ ä¸Šè®°å½•æŠ½å±‰
    (org-log-state-notes-insert-after-drawers nil)

    ;; refileä½¿ç”¨ç¼“å­˜
    (org-refile-use-cache t)
    ;; refileçš„ç›®çš„åœ°ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯agendaæ–‡ä»¶çš„æ‰€æœ‰æ ‡é¢˜
    (org-refile-targets '((org-agenda-files . (:maxlevel . 9))))
    ;; å°†æ–‡ä»¶ååŠ å…¥åˆ°è·¯å¾„
    (org-refile-use-outline-path 'file)
    ;; æ˜¯å¦æŒ‰æ­¥éª¤refile
    (org-outline-path-complete-in-steps nil)
    ;; å…è®¸åˆ›å»ºæ–°çš„æ ‡é¢˜è¡Œï¼Œä½†éœ€è¦ç¡®è®¤
    (org-refile-allow-creating-parent-nodes 'confirm)

    ;; è®¾ç½®æ ‡ç­¾çš„é»˜è®¤ä½ç½®ï¼Œé»˜è®¤æ˜¯ç¬¬77åˆ—å³å¯¹é½
    ;; (org-tags-column -77)
    ;; è‡ªåŠ¨å¯¹é½æ ‡ç­¾
    (org-auto-align-tags t)
    ;; æ ‡ç­¾ä¸ç»§æ‰¿
    (org-use-tag-inheritance nil)
    ;; åœ¨æ—¥ç¨‹è§†å›¾çš„æ ‡ç­¾ä¸ç»§æ‰¿
    (org-agenda-use-tag-inheritance nil)
    ;; æ ‡ç­¾å¿«é€Ÿé€‰æ‹©
    (org-use-fast-tag-selection t)
    ;; æ ‡ç­¾é€‰æ‹©ä¸éœ€è¦å›è½¦ç¡®è®¤
    (org-fast-tag-selection-single-key t)
    ;; å®šä¹‰äº†æœ‰åºå±æ€§çš„æ ‡é¢˜è¡Œä¹ŸåŠ ä¸Š OREDERD æ ‡ç­¾
    (org-track-ordered-property-with-tag t)
    ;; å§‹ç»ˆå­˜åœ¨çš„çš„æ ‡ç­¾
    (org-tag-persistent-alist '(("read"     . ?r)
                                ("mail"     . ?m)
                                ("emacs"    . ?e)
                                ("study"    . ?s)
                                ("work"     . ?w)))
    ;; é¢„å®šä¹‰å¥½çš„æ ‡ç­¾
    (org-tag-alist '((:startgroup)
                     ("crypt"    . ?c)
                     ("linux"    . ?l)
                     ("apple"    . ?a)
                     ("noexport" . ?n)
                     ("ignore"   . ?i)
                     ("TOC"      . ?t)
                     (:endgroup)))

    ;; å½’æ¡£è®¾ç½®
    (org-archive-location "%s_archive::datetree/")
    )

  ;; Org modeçš„é™„åŠ åŒ…ï¼Œæœ‰è¯¸å¤šé™„åŠ åŠŸèƒ½
  (use-package org-contrib
    :ensure t)
#+END_SRC
** Org mode ç¾åŒ–
+ é€šè¿‡ [[https://github.com/minad/org-modern][org-modern]] æ’ä»¶å¯¹Org modeè¿›è¡Œè¿›ä¸€æ­¥çš„ç¾åŒ–ã€‚
#+BEGIN_SRC emacs-lisp
;; org-modern
(use-package org-modern
  :ensure t
  :hook (after-init . (lambda ()
                        (setq org-modern-hide-stars 'leading)
                        (global-org-modern-mode t)))
  :config
  ;; æ ‡é¢˜è¡Œå‹å·å­—ç¬¦
  (setq org-modern-star ["â—‰" "â—‹" "âœ¸" "âœ³" "â—ˆ" "â—‡" "âœ¿" "â€" "âœœ"])
  ;; é¢å¤–çš„è¡Œé—´è·ï¼Œ0.1è¡¨ç¤º10%ï¼Œ1è¡¨ç¤º1px
  (setq-default line-spacing 0.1)
  ;; tagè¾¹æ¡†å®½åº¦ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸º `auto' å³è‡ªåŠ¨è®¡ç®—
  (setq org-modern-label-border 1)
  ;; è®¾ç½®è¡¨æ ¼ç«–çº¿å®½åº¦ï¼Œé»˜è®¤ä¸º3
  (setq org-modern-table-vertical 2)
  ;; è®¾ç½®è¡¨æ ¼æ¨ªçº¿ä¸º0ï¼Œé»˜è®¤ä¸º0.1
  (setq org-modern-table-horizontal 0)
  ;; å¤é€‰æ¡†ç¾åŒ–
  (setq org-modern-checkbox
        '((?X . #("â–¢âœ“" 0 2 (composition ((2)))))
          (?- . #("â–¢â€“" 0 2 (composition ((2)))))
          (?\s . #("â–¢" 0 1 (composition ((1)))))))
  ;; åˆ—è¡¨ç¬¦å·ç¾åŒ–
  (setq org-modern-list
        '((?- . "â€¢")
          (?+ . "â—¦")
          (?* . "â–¹")))
  ;; ä»£ç å—å·¦è¾¹åŠ ä¸Šä¸€æ¡ç«–è¾¹çº¿ï¼ˆéœ€è¦Org modeé¡¶å¤´ï¼Œå¦‚æœå¯ç”¨äº† `visual-fill-column-mode' ä¼šå¾ˆéš¾çœ‹ï¼‰
  (setq org-modern-block-fringe t)
  ;; ä»£ç å—ç±»å‹ç¾åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `prettify-symbols-mode'
  (setq org-modern-block-name nil)
  ;; #+å…³é”®å­—ç¾åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `prettify-symbols-mode'
  (setq org-modern-keyword nil)
  )
#+END_SRC
** org-appear è‡ªåŠ¨å±•å¼€å¼ºè°ƒé“¾æ¥
+ å€ŸåŠ©[[https://github.com/awth13/org-appear][org-appear]]æ’ä»¶ï¼Œå½“å…‰æ ‡ç§»åŠ¨åˆ°Org modeé‡Œçš„å¼ºè°ƒã€é“¾æ¥ä¸Šæ—¶ï¼Œä¼šè‡ªåŠ¨å±•å¼€ï¼Œä¾¿äºç¼–è¾‘ã€‚
#+BEGIN_SRC emacs-lisp
;; org-appear
(use-package org-appear
  :ensure t
  :hook (org-mode . org-appear-mode)
  :config
  (setq org-appear-autolinks t)
  (setq org-appear-autosubmarkers t)
  (setq org-appear-autoentities t)
  (setq org-appear-autokeywords t)
  (setq org-appear-inside-latex t)
  )
#+END_SRC
** org-auto-tangle è‡ªåŠ¨tangleè®¾ç½®
+ [[https://github.com/yilkalargaw/org-auto-tangle][org-auto-tangle]] æ’ä»¶å¯ä»¥åœ¨Org modeä¸‹è‡ªåŠ¨è¿›è¡Œtangleã€‚
#+BEGIN_SRC emacs-lisp
(use-package org-auto-tangle
  :ensure t
  :hook (org-mode . org-auto-tangle-mode)
  :config
  (setq org-auto-tangle-default t)
  )
#+END_SRC
** org-capture å¿«é€Ÿè®°å½•è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package org-capture
  :ensure nil
  :bind ("\e\e c" . (lambda () (interactive) (org-capture)))
  :hook ((org-capture-mode . (lambda ()
                               (setq-local org-complete-tags-always-offer-all-agenda-tags t)))
         (org-capture-mode . delete-other-windows))
  :custom
  (org-capture-use-agenda-date nil)
  ;; define common template
  (org-capture-templates `(("t" "Tasks" entry (file+headline "tasks.org" "Reminders")
                            "* TODO %i%?"
                            :empty-lines-after 1
                            :prepend t)
                           ("n" "Notes" entry (file+headline "capture.org" "Notes")
                            "* %? %^g\n%i\n"
                            :empty-lines-after 1)
                           ;; For EWW
                           ("b" "Bookmarks" entry (file+headline "capture.org" "Bookmarks")
                            "* %:description\n\n%a%?"
                            :empty-lines 1
                            :immediate-finish t)
                           ("d" "Diary")
                           ("dt" "Today's TODO list" entry (file+olp+datetree "diary.org")
                            "* Today's TODO list [/]\n%T\n\n** TODO %?"
                            :empty-lines 1
                            :jump-to-captured t)
                           ("do" "Other stuff" entry (file+olp+datetree "diary.org")
                            "* %?\n%T\n\n%i"
                            :empty-lines 1
                            :jump-to-captured t)
                           ))
  )
#+END_SRC
** denote ç¬”è®°è®¾ç½®
+ [[https://protesilaos.com/emacs/denote][denote]] æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç¬”è®°æ’ä»¶ï¼Œæ‹¥æœ‰è‰¯å¥½çš„æ–‡ä»¶åå‘½åæ¨¡æ¿
#+BEGIN_SRC emacs-lisp
(use-package denote
  :ensure t
  :hook (dired-mode . denote-dired-mode-in-directories)
  :bind (("C-c d n" . denote)
         ("C-c d d" . denote-date)
         ("C-c d t" . denote-type)
         ("C-c d s" . denote-subdirectory)
         ("C-c d f" . denote-open-or-create)
         ("C-c d r" . denote-dired-rename-file))
  :init
  (with-eval-after-load 'org-capture
    (setq denote-org-capture-specifiers "%l\n%i\n%?")
    (add-to-list 'org-capture-templates
                 '("N" "New note (with denote.el)" plain
                   (file denote-last-path)
                   #'denote-org-capture
                   :no-save t
                   :immediate-finish nil
                   :kill-buffer t
                   :jump-to-captured t)))
  :config
  (setq denote-directory (expand-file-name "~/org/"))
  (setq denote-known-keywords '("emacs" "entertainment" "reading" "studying"))
  (setq denote-infer-keywords t)
  (setq denote-sort-keywords t)
  ;; org is default, set others such as text, markdown-yaml, markdown-toml
  (setq denote-file-type nil)
  (setq denote-prompts '(title keywords))

  ;; We allow multi-word keywords by default.  The author's personal
  ;; preference is for single-word keywords for a more rigid workflow.
  (setq denote-allow-multi-word-keywords t)
  (setq denote-date-format nil)

  ;; If you use Markdown or plain text files (Org renders links as buttons
  ;; right away)
  (add-hook 'find-file-hook #'denote-link-buttonize-buffer)
  (setq denote-dired-rename-expert nil)

  ;; OR if only want it in `denote-dired-directories':
  (add-hook 'dired-mode-hook #'denote-dired-mode-in-directories)
  )
#+END_SRC
** Org-src
- ä»£ç å—åŸºç¡€è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package org-src
  :ensure nil
  :hook (org-babel-after-execute . org-redisplay-inline-images)
  :bind (("s-l" . show-line-number-in-src-block)
         :map org-src-mode-map
         ("C-c C-c" . org-edit-src-exit))
  :init
  ;; è®¾ç½®ä»£ç å—çš„é»˜è®¤å¤´å‚æ•°
  (setq org-babel-default-header-args
        '(
          (:eval    . "never-export")     ; å¯¼å‡ºæ—¶ä¸æ‰§è¡Œä»£ç å—
          (:session . "none")
          (:results . "replace")          ; æ‰§è¡Œç»“æœæ›¿æ¢
          (:exports . "both")             ; å¯¼å‡ºä»£ç å’Œç»“æœ
          (:cache   . "no")
          (:noweb   . "no")
          (:hlines  . "no")
          (:wrap    . "results")          ; ç»“æœé€šè¿‡#+begin_resultsåŒ…è£¹
          (:tangle  . "no")               ; ä¸å†™å…¥æ–‡ä»¶
          ))
  :config
  ;; ==================================
  ;; å¦‚æœå‡ºç°ä»£ç è¿è¡Œç»“æœä¸ºä¹±ç ï¼Œå¯ä»¥å‚è€ƒï¼š
  ;; https://github.com/nnicandro/emacs-jupyter/issues/366
  ;; ==================================
  (defun display-ansi-colors ()
    (ansi-color-apply-on-region (point-min) (point-max)))
  (add-hook 'org-babel-after-execute-hook #'display-ansi-colors)

  ;; ==============================================
  ;; é€šè¿‡overlayåœ¨ä»£ç å—é‡Œæ˜¾ç¤ºè¡Œå·ï¼Œs-læ˜¾ç¤ºï¼Œä»»æ„é”®å…³é—­
  ;; ==============================================
  (defvar number-line-overlays '()
    "List of overlays for line numbers.")

  (defun show-line-number-in-src-block ()
    (interactive)
    (save-excursion
      (let* ((src-block (org-element-context))
             (nlines (- (length
                         (s-split
                          "\n"
                          (org-element-property :value src-block)))
                        1)))
        (goto-char (org-element-property :begin src-block))
        (re-search-forward (regexp-quote (org-element-property :value src-block)))
        (goto-char (match-beginning 0))

        (cl-loop for i from 1 to nlines
                 do
                 (beginning-of-line)
                 (let (ov)
                   (setq ov (make-overlay (point) (point)))
                   (overlay-put ov 'before-string (format "%3s | " (number-to-string i)))
                   (add-to-list 'number-line-overlays ov))
                 (next-line))))

    ;; now read a char to clear them
    (read-key "Press a key to clear numbers.")
    (mapc 'delete-overlay number-line-overlays)
    (setq number-line-overlays '()))

  ;; =================================================
  ;; æ‰§è¡Œç»“æœåï¼Œå¦‚æœç»“æœæ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°†è‡ªåŠ¨åˆ›å»º
  ;; =================================================
  (defun check-directory-exists-before-src-execution (orig-fun
                                                      &optional arg
                                                      info
                                                      params)
    (when (and (assq ':file (cadr (cdr (org-babel-get-src-block-info))))
               (member (car (org-babel-get-src-block-info)) '("mermaid" "ditaa" "dot" "lilypond" "plantuml" "gnuplot" "d2")))
      (let ((foldername (file-name-directory (alist-get :file (nth 2 (org-babel-get-src-block-info))))))
        (if (not (file-exists-p foldername))
            (mkdir foldername)))))
  (advice-add 'org-babel-execute-src-block :before #'check-directory-exists-before-src-execution)

  ;; =================================================
  ;; è‡ªåŠ¨ç»™ç»“æœçš„å›¾ç‰‡åŠ ä¸Šç›¸å…³å±æ€§
  ;; =================================================
  (setq original-image-width-before-del "400") ; è®¾ç½®å›¾ç‰‡çš„é»˜è®¤å®½åº¦ä¸º400
  (setq original-caption-before-del "")        ; è®¾ç½®é»˜è®¤çš„å›¾ç¤ºæ–‡æœ¬ä¸ºç©º

  (defun insert-attr-decls ()
    "insert string before babel execution results"
    (insert (concat "\n#+CAPTION:"
                    original-caption-before-del
                    "\n#+ATTR_ORG: :width "
                    original-image-width-before-del
                    "\n#+ATTR_LATEX: :width "
                    (if (>= (/ (string-to-number original-image-width-before-del) 800.0) 1)
                        "1.0"
                      (number-to-string (/ (string-to-number original-image-width-before-del) 800.0)))
                    "\\linewidth :float nil"
                    "\n#+ATTR_HTML: :width "
                    original-image-width-before-del
                    )))

  (defun insert-attr-decls-at (s)
    "insert string right after specific string"
    (let ((case-fold-search t))
      (if (search-forward s nil t)
          (progn
            ;; (search-backward s nil t)
            (insert-attr-decls)))))

  (defun insert-attr-decls-at-results (orig-fun
                                       &optional arg
                                       info
                                       param)
    "insert extra image attributes after babel execution"
    (interactive)
    (progn
      (when (member (car (org-babel-get-src-block-info)) '("mermaid" "ditaa" "dot" "lilypond" "plantuml" "gnuplot" "d2"))
        (setq original-image-width-before-del (number-to-string (if-let* ((babel-width (alist-get :width (nth 2 (org-babel-get-src-block-info))))) babel-width (string-to-number original-image-width-before-del))))
        (save-excursion
          ;; `#+begin_results' for :wrap results, `#+RESULTS:' for non :wrap results
          (insert-attr-decls-at "#+begin_results")))
      (org-redisplay-inline-images)))
  (advice-add 'org-babel-execute-src-block :after #'insert-attr-decls-at-results)

  ;; å†æ¬¡æ‰§è¡Œæ—¶éœ€è¦å°†æ—§çš„å›¾ç‰‡ç›¸å…³å‚æ•°è¡Œåˆ é™¤ï¼Œå¹¶ä»ä¸­å¤´å‚æ•°ä¸­è·å¾—å®½åº¦å‚æ•°ï¼Œå‚è€ƒ
  ;; https://emacs.stackexchange.com/questions/57710/how-to-set-image-size-in-result-of-src-block-in-org-mode
  (defun get-attributes-from-src-block-result (&rest args)
    "get information via last babel execution"
    (let ((location (org-babel-where-is-src-block-result))
          ;; ä¸»è¦è·å–çš„æ˜¯å›¾ç¤ºæ–‡å­—å’Œå®½åº¦ä¿¡æ¯ï¼Œä¸‹é¢è¿™ä¸ªæ­£åˆ™å°±æ˜¯ä¸ºäº†æ•è·è¿™ä¸¤ä¸ªä¿¡æ¯
          (attr-regexp "[:blank:]*#\\+\\(ATTR_ORG: :width \\([0-9]\\{3\\}\\)\\|CAPTION:\\(.*\\)\\)"))
      (setq original-caption-before-del "") ; é‡ç½®ä¸ºç©º
      (when location
        (save-excursion
          (goto-char location)
          (when (looking-at (concat org-babel-result-regexp ".*$"))
            (next-line 2)               ; å› ä¸ºæœ‰ä¸ªbegin_resultçš„æŠ½å±‰ï¼Œæ‰€ä»¥å¾€ä¸‹2è¡Œ
            ;; é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥æ•è·éœ€è¦çš„ä¿¡æ¯
            (while (looking-at attr-regexp)
              (when (match-string 2)
                (setq original-image-width-before-del (match-string 2)))
              (when (match-string 3)
                (setq original-caption-before-del (match-string 3)))
              (next-line)               ; å› ä¸ºè®¾ç½®äº†:wrapï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦åˆ é™¤è¿™ä¸€è¡Œ
              )
            )))))
  (advice-add 'org-babel-execute-src-block :before #'get-attributes-from-src-block-result)

  :custom
  ;; ä»£ç å—è¯­æ³•é«˜äº®
  (org-src-fontify-natively t)
  ;; ä½¿ç”¨ç¼–ç¨‹è¯­è¨€çš„TABç»‘å®šè®¾ç½®
  (org-src-tab-acts-natively t)
  ;; ä¿ç•™ä»£ç å—å‰é¢çš„ç©ºæ ¼
  (org-src-preserve-indentation t)
  ;; ä»£ç å—ç¼–è¾‘çª—å£çš„æ‰“å¼€æ–¹å¼ï¼šå½“å‰çª—å£+ä»£ç å—ç¼–è¾‘çª—å£
  (org-src-window-setup 'reorganize-frame)
  ;; æ‰§è¡Œå‰æ˜¯å¦éœ€è¦ç¡®è®¤
  (org-confirm-babel-evaluate nil)
  ;; ä»£ç å—é»˜è®¤å‰ç½®å¤šå°‘ç©ºæ ¼
  (org-edit-src-content-indentation 0)
  ;; ä»£ç å—çš„è¯­è¨€æ¨¡å¼è®¾ç½®ï¼Œè®¾ç½®ä¹‹åæ‰èƒ½æ­£ç¡®è¯­æ³•é«˜äº®
  (org-src-lang-modes '(("C"            . c)
                        ("C++"          . c++)
                        ("bash"         . sh)
                        ("cpp"          . c++)
                        ("elisp"        . emacs-lisp)
                        ("python"       . python)
                        ("shell"        . sh)
                        ("mysql"        . sql)
                        ))
  ;; åœ¨è¿™ä¸ªé˜¶æ®µï¼Œåªéœ€è¦åŠ è½½é»˜è®¤æ”¯æŒçš„è¯­è¨€
  (org-babel-load-languages '((python          . t)
                              (awk             . t)
                              (C               . t)
                              (calc            . t)
                              (emacs-lisp      . t)
                              (eshell          . t)
                              (shell           . t)
                              (sql             . t)
                              (css             . t)
                              ))
  )
#+END_SRC
** org-agenda åŸºæœ¬è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package org-agenda
  :ensure nil
  :hook (org-agenda-finalize . org-agenda-to-appt)
  :bind (("\e\e a" . org-agenda)
         :map org-agenda-mode-map
         ("i" . (lambda () (interactive) (org-capture nil "d")))
         ("J" . consult-org-agenda))
  :config
  ;; æ—¥ç¨‹æ¨¡å¼çš„æ—¥æœŸæ ¼å¼è®¾ç½®
  (setq org-agenda-format-date 'org-agenda-format-date-aligned)
  (defun org-agenda-format-date-aligned (date)
    "Format a DATE string for display in the daily/weekly agenda, or timeline.

This function makes sure that dates are aligned for easy reading."
    (require 'cal-iso)
    (let* ((dayname (aref cal-china-x-days
                          (calendar-day-of-week date)))
           (day (cadr date))
           (month (car date))
           (year (nth 2 date))
           (day-of-week (calendar-day-of-week date))
           (iso-week (org-days-to-iso-week
                      (calendar-absolute-from-gregorian date)))
           (cn-date (calendar-chinese-from-absolute (calendar-absolute-from-gregorian date)))
           (cn-month (cl-caddr cn-date))
           (cn-day (cl-cadddr cn-date))
           (cn-month-string (concat (aref cal-china-x-month-name
                                          (1- (floor cn-month)))
                                    (if (integerp cn-month)
                                        ""
                                      "ï¼ˆé—°æœˆï¼‰")))
           (cn-day-string (aref cal-china-x-day-name
                                (1- cn-day)))
           (extra (format " å†œå†%s%s%s%s"
                          (if (or (eq org-agenda-current-span 'day)
                                  (= day-of-week 1)
                                  (= cn-day 1))
                              cn-month-string
                            "")
                          (if (or (= day-of-week 1)
                                  (= cn-day 1))
                              (if (integerp cn-month) "" "[é—°]")
                            "")
                          cn-day-string
                          (if (or (= day-of-week 1)
                                  (eq org-agenda-current-span 'day))
                              (format " ä»Šå¹´ç¬¬%02då‘¨" iso-week)
                            "")
                          ))
           )
      (format "%04d-%02d-%02d æ˜ŸæœŸ%s%s%s\n" year month
              day dayname extra (concat " ç¬¬" (format-time-string "%j") "å¤©"))))

  ;; æ˜¾ç¤ºæ—¶é—´çº¿
  (setq org-agenda-use-time-grid t)
  ;; è®¾ç½®é¢åŒ…å±‘åˆ†éš”ç¬¦
  ;; (setq org-agenda-breadcrumbs-separator " â± ")
  ;; è®¾ç½®æ—¶é—´çº¿çš„å½“å‰æ—¶é—´æŒ‡ç¤ºä¸²
  (setq org-agenda-current-time-string "â°------------now")
  ;; æ—¶é—´çº¿èŒƒå›´å’Œé¢—ç²’åº¦è®¾ç½®
  (setq org-agenda-time-grid (quote ((daily today)
                                     (0600 0800 1000 1200
                                           1400 1600 1800
                                           2000 2200 2400)
                                     "......" "----------------")))
  ;; æ—¥ç¨‹è§†å›¾çš„å‰ç¼€è®¾ç½®
  (setq org-agenda-prefix-format '((agenda . " %i %-25:c %5t %s")
                                   (todo   . " %i %-25:c ")
                                   (tags   . " %i %-25:c ")
                                   (search . " %i %-25:c ")))
  ;; å¯¹äºè®¡åˆ’ä¸­çš„ä»»åŠ¡åœ¨è§†å›¾é‡Œçš„æ˜¾ç¤º
  (setq org-agenda-scheduled-leaders
        '("è®¡åˆ’ " "åº”åœ¨%02då¤©å‰å¼€å§‹ "))
  ;; å¯¹äºæˆªæ­¢æ—¥æœŸçš„ä»»åŠ¡åœ¨è§†å›¾é‡Œçš„æ˜¾ç¤º
  (setq org-agenda-deadline-leaders
        '("æˆªæ­¢ " "è¿˜æœ‰%02då¤©åˆ°æœŸ " "å·²ç»è¿‡æœŸ%02då¤© "))

  ;; =====================
  ;; è‡ªå®šä¹‰æ—¥ç¨‹è§†å›¾ï¼Œåˆ†åˆ«æ˜¾ç¤ºTODOï¼ŒWIPï¼ŒWIATä¸­çš„ä»»åŠ¡
  ;; né”®æ˜¾ç¤ºè‡ªå®šä¹‰è§†å›¾ï¼Œpé”®çº¯æ–‡æœ¬è§†å›¾ï¼Œaé”®é»˜è®¤è§†å›¾
  ;; =====================
  (defvar my-org-custom-daily-agenda
    `((todo "TODO"
            ((org-agenda-block-separator nil)
             (org-agenda-overriding-header "æ‰€æœ‰å¾…åŠä»»åŠ¡\n")))
      (todo "WIP"
            ((org-agenda-block-separator nil)
             (org-agenda-overriding-header "\nè¿›è¡Œä¸­çš„ä»»åŠ¡\n")))
      (todo "WAIT"
            ((org-agenda-block-separator nil)
             (org-agenda-overriding-header "\nç­‰å¾…ä¸­çš„ä»»åŠ¡\n")))
      (agenda "" ((org-agenda-block-separator nil)
                  (org-agenda-overriding-header "\nä»Šæ—¥æ—¥ç¨‹\n"))))
    "Custom agenda for use in `org-agenda-custom-commands'.")
  (setq org-agenda-custom-commands
        `(("n" "Daily agenda and top priority tasks"
           ,my-org-custom-daily-agenda)
          ("p" "Plain text daily agenda and top priorities"
           ,my-org-custom-daily-agenda
           ((org-agenda-with-colors nil)
            (org-agenda-prefix-format "%t %s")
            (org-agenda-current-time-string ,(car (last org-agenda-time-grid)))
            (org-agenda-fontify-priorities nil)
            (org-agenda-remove-tags t))
           ("agenda.txt"))))

  ;; æ—¶é—´æˆ³æ ¼å¼è®¾ç½®ï¼Œä¼šå½±å“åˆ° `svg-tag' ç­‰åŸºäºæ­£åˆ™çš„è®¾ç½®
  ;; è¿™é‡Œè®¾ç½®å®Œåæ˜¯ <2022-12-24 æ˜ŸæœŸå…­> æˆ– <2022-12-24 æ˜ŸæœŸå…­ 06:53>
  (setq system-time-locale "zh_CN.UTF-8")
  (setq org-time-stamp-formats '("<%Y-%m-%d %A>" . "<%Y-%m-%d %A %H:%M>"))
  ;; ä¸åŒæ—¥ç¨‹ç±»åˆ«é—´çš„é—´éš”
  (setq org-cycle-separator-lines 2)
  :custom
  ;; è®¾ç½®éœ€è¦è¢«æ—¥ç¨‹ç›‘æ§çš„orgæ–‡ä»¶
  (org-agenda-files
   (list (expand-file-name "tasks.org" org-directory)
         (expand-file-name "diary.org" org-directory)
         (expand-file-name "phd.org" org-directory)
         (expand-file-name "habits.org" org-directory)
         (expand-file-name "mail.org" org-directory)
         (expand-file-name "emacs-config.org" user-emacs-directory)
         ))
  ;; è®¾ç½®orgçš„æ—¥è®°æ–‡ä»¶
  (org-agenda-diary-file (expand-file-name "diary.org" org-directory))
  ;; æ—¥è®°æ’å…¥ç²¾ç¡®æ—¶é—´æˆ³
  (org-agenda-insert-diary-extract-time t)
  ;; è®¾ç½®æ—¥ç¨‹è§†å›¾æ›´åŠ ç´§å‡‘
  ;; (org-agenda-compact-blocks t)
  ;; æ—¥ç¨‹è§†å›¾çš„å—åˆ†éš”ç¬¦
  (org-agenda-block-separator ?â”€)
  ;; æ—¥è§†å›¾è¿˜æ˜¯å‘¨è§†å›¾ï¼Œé€šè¿‡ v-d, v-w, v-m, v-y åˆ‡æ¢è§†å›¾ï¼Œé»˜è®¤å‘¨è§†å›¾
  (org-agenda-span 'day)
  ;; qé€€å‡ºæ—¶åˆ é™¤agendaç¼“å†²åŒº
  (org-agenda-sticky t)
  ;; æ˜¯å¦åŒ…å«ç›´æ¥æ—¥æœŸ
  (org-agenda-include-deadlines t)
  ;; ç¦æ­¢æ—¥ç¨‹å¯åŠ¨ç”»é¢
  (org-agenda-inhibit-startup t)
  ;; æ˜¾ç¤ºæ¯ä¸€å¤©ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æ¡ç›®
  (org-agenda-show-all-dates t)
  ;; æ—¶é—´ä¸è¶³ä½æ—¶å‰é¢åŠ 0
  (org-agenda-time-leading-zero t)
  ;; æ—¥ç¨‹åŒæ—¶å¯åŠ¨log mode
  (org-agenda-start-with-log-mode t)
  ;; æ—¥ç¨‹åŒæ—¶å¯åŠ¨ä»»åŠ¡æ—¶é—´è®°å½•æŠ¥å‘Šæ¨¡å¼
  (org-agenda-start-with-clockreport-mode t)
  ;; æˆªæ­¢çš„ä»»åŠ¡å®Œæˆåä¸æ˜¾ç¤º
  ;; (org-agenda-skip-deadline-if-done t)
  ;; å½“è®¡åˆ’çš„ä»»åŠ¡å®Œæˆåä¸æ˜¾ç¤º
  (org-agenda-skip-scheduled-if-done t)
  ;; è®¡åˆ’è¿‡æœŸä¸Šé™
  (org-scheduled-past-days 365)
  ;; è®¡åˆ’æˆªæ­¢ä¸Šé™
  (org-deadline-past-days 365)
  ;; è®¡åˆ’ä¸­çš„ä»»åŠ¡ä¸æé†’æˆªæ­¢æ—¶é—´
  (org-agenda-skip-deadline-prewarning-if-scheduled 1)
  (org-agenda-skip-scheduled-if-deadline-is-shown t)
  (org-agenda-skip-timestamp-if-deadline-is-shown t)
  ;; è®¾ç½®å·¥æ—¶è®°å½•æŠ¥å‘Šæ ¼å¼
  (org-agenda-clockreport-parameter-plist
   '(:link t :maxlevel 5 :fileskip0 t :compact nil :narrow 80))
  (org-agenda-columns-add-appointments-to-effort-sum t)
  (org-agenda-restore-windows-after-quit t)
  (org-agenda-window-setup 'current-window)
  ;; æ ‡ç­¾æ˜¾ç¤ºçš„ä½ç½®ï¼Œç¬¬100åˆ—å¾€å‰å³å¯¹é½
  (org-agenda-tags-column -100)
  ;; ä»æ˜ŸæœŸä¸€å¼€å§‹ä½œä¸ºä¸€å‘¨ç¬¬ä¸€å¤©
  (org-agenda-start-on-weekday 1)
  ;; æ˜¯å¦ä½¿ç”¨am/pm
  ;; (org-agenda-timegrid-use-ampm nil)
  ;; æœç´¢æ˜¯ä¸çœ‹æ—¶é—´
  (org-agenda-search-headline-for-time nil)
  ;; æå‰3å¤©æˆªæ­¢æ—¥æœŸåˆ°æœŸå‘Šè­¦
  (org-deadline-warning-days 3)
  )
#+END_SRC
** calendar åŸºæœ¬è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package calendar
  :ensure nil
  :hook (calendar-today-visible . calendar-mark-today)
  :custom
  ;; æ˜¯å¦æ˜¾ç¤ºä¸­å›½èŠ‚æ—¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ `cal-chinese-x' æ’ä»¶
  (calendar-chinese-all-holidays-flag nil)
  ;; æ˜¯å¦æ˜¾ç¤ºèŠ‚æ—¥
  (calendar-mark-holidays-flag t)
  ;; æ˜¯å¦æ˜¾ç¤ºEmacsçš„æ—¥è®°ï¼Œæˆ‘ä»¬ä½¿ç”¨orgçš„æ—¥è®°
  (calendar-mark-diary-entries-flag nil)
  ;; æ•°å­—æ–¹å¼æ˜¾ç¤ºæ—¶åŒºï¼Œå¦‚ +0800ï¼Œé»˜è®¤æ˜¯å­—ç¬¦æ–¹å¼å¦‚ CST
  (calendar-time-zone-style 'numeric)
  ;; æ—¥æœŸæ˜¾ç¤ºæ–¹å¼ï¼šyear/month/day
  (calendar-date-style 'iso)
  ;; ä¸­æ–‡å¤©å¹²åœ°æ”¯è®¾ç½®
  (calendar-chinese-celestial-stem ["ç”²" "ä¹™" "ä¸™" "ä¸" "æˆŠ" "å·±" "åºš" "è¾›" "å£¬" "ç™¸"])
  (calendar-chinese-terrestrial-branch ["å­" "ä¸‘" "å¯…" "å¯" "è¾°" "å·³" "åˆ" "æœª" "ç”³" "é…‰" "æˆŒ" "äº¥"])
  ;; è®¾ç½®ä¸­æ–‡æœˆä»½
  (calendar-month-name-array ["ä¸€æœˆ" "äºŒæœˆ" "ä¸‰æœˆ" "å››æœˆ" "äº”æœˆ" "å…­æœˆ" "ä¸ƒæœˆ" "å…«æœˆ" "ä¹æœˆ" "åæœˆ" "åä¸€æœˆ" "åäºŒæœˆ"])
  ;; è®¾ç½®æ˜ŸæœŸæ ‡é¢˜æ˜¾ç¤º
  (calendar-day-name-array ["æ—¥" "ä¸€" "äºŒ" "ä¸‰" "å››" "äº”" "å…­"])
  ;; å‘¨ä¸€ä½œä¸ºä¸€å‘¨ç¬¬ä¸€å¤©
  (calendar-week-start-day 1)
  )
#+END_SRC
** æ—¥å†ä¸­æ–‡å¢å¼º
+ é€šè¿‡ [[https://github.com/xwl/cal-china-x][cal-china-x]] æ’ä»¶è¿›ä¸€æ­¥å¢å¼ºä¸­æ–‡æ—¥å†ï¼Œæ˜¾ç¤ºå†œå†ç­‰ä¿¡æ¯
#+BEGIN_SRC emacs-lisp
;; æ—¶é—´è§£æå¢åŠ ä¸­æ–‡æ‹¼éŸ³
(use-package parse-time
  :ensure nil
  :defer t
  :config
  (setq parse-time-months
        (append '(("yiy" . 1) ("ery" . 2) ("sany" . 3)
                  ("siy" . 4) ("wuy" . 5) ("liuy" . 6)
                  ("qiy" . 7) ("bay" . 8) ("jiuy" . 9)
                  ("shiy" . 10) ("shiyiy" . 11) ("shiery" . 12)
                  ("yiyue" . 1) ("eryue" . 2) ("sanyue" . 3)
                  ("siyue" . 4) ("wuyue" . 5) ("liuyue" . 6)
                  ("qiyue" . 7) ("bayue" . 8) ("jiuyue" . 9)
                  ("shiyue" . 10) ("shiyiyue" . 11) ("shieryue" . 12))
                parse-time-months))

  (setq parse-time-weekdays
        (append '(("zri" . 0) ("zqi" . 0)
                  ("zyi" . 1) ("zer" . 2) ("zsan" . 3)
                  ("zsi" . 4) ("zwu" . 5) ("zliu" . 6)
                  ("zr" . 0) ("zq" . 0)

                  ("zy" . 1) ("ze" . 2) ("zs" . 3)
                  ("zsi" . 4) ("zw" . 5) ("zl" . 6))
                parse-time-weekdays)))

;; ä¸­å›½èŠ‚æ—¥è®¾ç½®
(use-package cal-china-x
  :ensure t
  :commands cal-china-x-setup
  :hook (after-init . cal-china-x-setup)
  :config
  ;; é‡è¦èŠ‚æ—¥è®¾ç½®
  (setq cal-china-x-important-holidays cal-china-x-chinese-holidays)
  ;; æ‰€æœ‰èŠ‚æ—¥è®¾ç½®
  (setq cal-china-x-general-holidays
        '(;;å…¬å†èŠ‚æ—¥
          (holiday-fixed 1 1 "å…ƒæ—¦")
          (holiday-fixed 2 14 "æƒ…äººèŠ‚")
          (holiday-fixed 3 8 "å¦‡å¥³èŠ‚")
          (holiday-fixed 3 14 "ç™½è‰²æƒ…äººèŠ‚")
          (holiday-fixed 4 1 "æ„šäººèŠ‚")
          (holiday-fixed 5 1 "åŠ³åŠ¨èŠ‚")
          (holiday-fixed 5 4 "é’å¹´èŠ‚")
          (holiday-float 5 0 2 "æ¯äº²èŠ‚")
          (holiday-fixed 6 1 "å„¿ç«¥èŠ‚")
          (holiday-float 6 0 3 "çˆ¶äº²èŠ‚")
          (holiday-fixed 9 10 "æ•™å¸ˆèŠ‚")
          (holiday-fixed 10 1 "å›½åº†èŠ‚")
          (holiday-fixed 10 2 "å›½åº†èŠ‚")
          (holiday-fixed 10 3 "å›½åº†èŠ‚")
          (holiday-fixed 10 24 "ç¨‹åºå‘˜èŠ‚")
          (holiday-fixed 11 11 "åŒ11è´­ç‰©èŠ‚")
          (holiday-fixed 12 25 "åœ£è¯èŠ‚")
          ;; å†œå†èŠ‚æ—¥
          (holiday-lunar 12 30 "æ˜¥èŠ‚" 0)
          (holiday-lunar 1 1 "æ˜¥èŠ‚" 0)
          (holiday-lunar 1 2 "æ˜¥èŠ‚" 0)
          (holiday-lunar 1 15 "å…ƒå®µèŠ‚" 0)
          (holiday-solar-term "æ¸…æ˜" "æ¸…æ˜èŠ‚")
          (holiday-solar-term "å°å¯’" "å°å¯’")
          (holiday-solar-term "å¤§å¯’" "å¤§å¯’")
          (holiday-solar-term "ç«‹æ˜¥" "ç«‹æ˜¥")
          (holiday-solar-term "é›¨æ°´" "é›¨æ°´")
          (holiday-solar-term "æƒŠè›°" "æƒŠè›°")
          (holiday-solar-term "æ˜¥åˆ†" "æ˜¥åˆ†")
          (holiday-solar-term "è°·é›¨" "è°·é›¨")
          (holiday-solar-term "ç«‹å¤" "ç«‹å¤")
          (holiday-solar-term "å°æ»¡" "å°æ»¡")
          (holiday-solar-term "èŠ’ç§" "èŠ’ç§")
          (holiday-solar-term "å¤è‡³" "å¤è‡³")
          (holiday-solar-term "å°æš‘" "å°æš‘")
          (holiday-solar-term "å¤§æš‘" "å¤§æš‘")
          (holiday-solar-term "ç«‹ç§‹" "ç«‹ç§‹")
          (holiday-solar-term "å¤„æš‘" "å¤„æš‘")
          (holiday-solar-term "ç™½éœ²" "ç™½éœ²")
          (holiday-solar-term "ç§‹åˆ†" "ç§‹åˆ†")
          (holiday-solar-term "å¯’éœ²" "å¯’éœ²")
          (holiday-solar-term "éœœé™" "éœœé™")
          (holiday-solar-term "ç«‹å†¬" "ç«‹å†¬")
          (holiday-solar-term "å°é›ª" "å°é›ª")
          (holiday-solar-term "å¤§é›ª" "å¤§é›ª")
          (holiday-solar-term "å†¬è‡³" "å†¬è‡³")
          (holiday-lunar 5 5 "ç«¯åˆèŠ‚" 0)
          (holiday-lunar 8 15 "ä¸­ç§‹èŠ‚" 0)
          (holiday-lunar 7 7 "ä¸ƒå¤•æƒ…äººèŠ‚" 0)
          (holiday-lunar 12 8 "è…Šå…«èŠ‚" 0)
          (holiday-lunar 9 9 "é‡é˜³èŠ‚" 0)))
  ;; è®¾ç½®æ—¥å†çš„èŠ‚æ—¥ï¼Œé€šç”¨èŠ‚æ—¥å·²ç»åŒ…å«äº†æ‰€æœ‰èŠ‚æ—¥
  (setq calendar-holidays (append cal-china-x-general-holidays)))
#+END_SRC
** org-habit ä¹ æƒ¯ç®¡ç†
#+BEGIN_SRC emacs-lisp
(use-package org-habit
  :ensure nil
  :defer t
  :custom
  (org-habit-show-habits t)
  (org-habit-graph-column 70)
  (org-habit-show-all-today t)
  (org-habit-show-done-always-green t)
  (org-habit-scheduled-past-days t)
  ;; org habit show 7 days before today and 7 days after today. ! means not done. * means done.
  (org-habit-preceding-days 7)
  )
#+END_SRC
** init-org.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-org)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-org.el ends here
#+END_SRC
* init-completion.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-completion.el :mkdirp yes
:END:
** init-completion.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-completion.el --- Completion settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** yasnippet
+ æä¾›è¡¥å…¨æ¨¡æ¿ï¼Œå‚è€ƒ [[http://joaotavora.github.io/yasnippet/][yasnippet manual]]
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :ensure t
    :diminish yas-minor-mode
    :hook ((after-init . yas-reload-all)
           ((prog-mode LaTeX-mode org-mode) . yas-minor-mode))
    :config
    ;; Suppress warning for yasnippet code.
    (require 'warnings)
    (yas-global-mode 1)
    (add-to-list 'warning-suppress-types '(yasnippet backquote-change))

    (setq yas-prompt-functions '(yas-x-prompt yas-dropdown-prompt))
    (defun smarter-yas-expand-next-field ()
      "Try to `yas-expand' then `yas-next-field' at current cursor position."
      (interactive)
      (let ((old-point (point))
            (old-tick (buffer-chars-modified-tick)))
        (yas-expand)
        (when (and (eq old-point (point))
                   (eq old-tick (buffer-chars-modified-tick)))
          (ignore-errors (yas-next-field))))))
#+END_SRC
** marginalia
+ marginalia æ’ä»¶ç»™è¿·ä½ ç¼“å†²åŒºçš„è¡¥å…¨å€™é€‰æ¡ç›®æ·»åŠ ä¸€äº›æç¤ºã€‚
#+BEGIN_SRC emacs-lisp
;; minibuffer helpful annotations
(use-package marginalia
  :ensure t
  :hook (after-init . marginalia-mode)
  :custom
  (marginalia-annotators '(marginalia-annotators-heavy marginalia-annotators-light nil)))
#+END_SRC
** orderless
#+BEGIN_SRC emacs-lisp
(use-package orderless
  :defer 1
  :custom
  (completion-styles '(orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles partial-completion)))))
#+END_SRC
** all-the-icons-completion
+ å€ŸåŠ© [[https://github.com/iyefrat/all-the-icons-completion][all-the-icons-completion]] æ’ä»¶ä¸ºè¿·ä½ ç¼“å†²åŒºçš„è¡¥å…¨ç³»ç»Ÿæ·»åŠ ç¾è§‚å›¾æ ‡
#+BEGIN_SRC emacs-lisp
(use-package all-the-icons-completion
  :ensure t
  :hook ((after-init . all-the-icons-completion-mode)
         (marginalia-mode . all-the-icons-completion-marginalia-setup))
  )
#+END_SRC
** posframe
+ tumashu å¼€å‘çš„ [[https://github.com/tumashu/posframe][posframe]] æ’ä»¶æ”¯æŒ posframe çš„å¼¹å‡º
#+BEGIN_SRC emacs-lisp
(use-package posframe
  :ensure t)
#+END_SRC
** lsp-bridge
+ [[https://github.com/manateelazycat/lsp-bridge][lsp-bridge]] æ’ä»¶æ—¨åœ¨å®ç°Emacsç”Ÿæ€ä¸­æœ€å¿«çš„LSPå®¢æˆ·ç«¯ã€‚
#+BEGIN_SRC emacs-lisp
;;lsp-bridge
;;; https://github.com/manateelazycat/lsp-bridge/blob/master/README.zh-CN.md
(add-to-list 'load-path "~/.emacs.d/lsp-bridge/")
(require 'lsp-bridge)
(global-lsp-bridge-mode)
(setq lsp-bridge-python-lsp-server "pyright")
#+END_SRC
** init-completion.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-completion)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-completion.el ends here
#+END_SRC
* init-tools.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-tools.el :mkdirp yes
:END:
** init-tools.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-tools.el --- Tools settings -*- lexical-binding: t -*-
;;; Commentary: Useful tools to make Emacs efficient!

;;; Code:
#+END_SRC
** exec-path-from-shell
+ purcell å¼€å‘çš„ [[https://github.com/purcell/exec-path-from-shell][exec-path-from-shell]] è®©Emacsä½¿ç”¨ç”¨æˆ·shellæ‰€è®¾å®šçš„$PATH
#+BEGIN_SRC emacs-lisp
(use-package exec-path-from-shell
  :ensure t
  :config
  (when (memq window-system '(mac ns x))
    (exec-path-from-shell-initialize)))
#+END_SRC
** restart-emacs é‡å¯
#+BEGIN_SRC emacs-lisp
(use-package restart-emacs
  :ensure t)
#+END_SRC
** which-key å¿«æ·é”®
+ [[https://github.com/justbur/emacs-which-key][which-key]] æ’ä»¶å°†æç¤ºå¿«æ·é”®
#+BEGIN_SRC emacs-lisp
(use-package which-key
  :ensure t
  :init (which-key-mode))
#+END_SRC
** emacs-rime
#+BEGIN_SRC emacs-lisp
;; (add-to-list 'load-path "~/.emacs.d/emacs-rime/")
;; (require 'rime)

;; ;; é›¾å‡‡æ‹¼éŸ³
;; ;;; https://emacs-china.org/t/emacs-rime/24125
;; ;;; https://github.com/iDvel/rime-ice

;; ;;; Code:
;; (setq rime-user-data-dir "~/.local/share/fcitx5/rime")

;; (setq rime-posframe-properties
;;       (list :background-color "#333333"
;;             :foreground-color "#dcdccc"
;;             :font "WenQuanYi Micro Hei Mono-14"
;;             :internal-border-width 10))

;; (setq default-input-method "rime"
;;       rime-show-candidate 'posframe)
#+END_SRC
** fanyi åœ¨çº¿è¯å…¸
#+BEGIN_SRC emacs-lisp
(use-package fanyi
  :ensure t
  :bind-keymap ("\e\e =" . fanyi-map)
  :bind (:map fanyi-map
              ("w" . fanyi-dwim2)
              ("i" . fanyi-dwim))
  :init
  ;; to support `org-store-link' and `org-insert-link'
  (require 'ol-fanyi)
  ;; å¦‚æœå½“å‰æŒ‡é’ˆä¸‹æœ‰å•è¯ï¼Œé€‰æ‹©å½“å‰å•è¯ï¼Œå¦åˆ™é€‰æ‹©å‰ªè´´æ¿
  (with-eval-after-load 'org-capture
    (add-to-list 'org-capture-templates
                 '("w" "New word" entry (file+olp+datetree "20221001T221032--vocabulary__studying.org" "New")
                   "* %^{Input the new word:|%(cond ((with-current-buffer (org-capture-get :original-buffer) (thing-at-point 'word 'no-properties))) ((clipboard/get)))}\n\n[[fanyi:%\\1][%\\1]]\n\n[[http://dict.cn/%\\1][æµ·è¯ï¼š%\\1]]%?"
                   :tree-type day
                   :empty-lines 1
                   :jump-to-captured t)))
  :config
  (defvar fanyi-map nil "keymap for `fanyi")
  (setq fanyi-map (make-sparse-keymap))
  (setq fanyi-sound-player "mpv")
  :custom
  (fanyi-providers '(;; æµ·è¯
                     fanyi-haici-provider
                     ;; æœ‰é“åŒä¹‰è¯è¯å…¸
                     fanyi-youdao-thesaurus-provider
                     ;; Longman
                     fanyi-longman-provider
                     ;; ;; Etymonline
                     ;; fanyi-etymon-provider
                     ;; ;; LibreTranslate
                     ;; fanyi-libre-provider
                     )))
#+END_SRC
** Beancount å¤å¼ç°¿è®°æ³•
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/lisp/")
(require 'beancount)
(add-to-list 'auto-mode-alist '("\\.bean\\'" . beancount-mode))
;; (add-hook 'beancount-mode-hook
;;   (lambda () (setq-local electric-indent-chars nil)))
(add-hook 'beancount-mode-hook #'outline-minor-mode)
(define-key beancount-mode-map (kbd "C-c C-n") #'outline-next-visible-heading)
(define-key beancount-mode-map (kbd "C-c C-p") #'outline-previous-visible-heading)
#+END_SRC
** init-tools.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-tools)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-tools.el ends here
#+END_SRC
* init-dev.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-dev.el :mkdirp yes
:END:
** init-dev.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-dev.el --- Development settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** projectile é¡¹ç›®ç®¡ç†
+ å‚è€ƒ [[https://zhuanlan.zhihu.com/p/467681146][ä¸“ä¸š Emacs å…¥é—¨ï¼ˆä¸ƒï¼‰ï¼šæ’ä»¶ç¯‡â€”â€”ç¼–ç¨‹å¼€å‘ç±»]]
#+BEGIN_SRC emacs-lisp
(use-package projectile
  :ensure t
  :bind (("C-c p" . projectile-command-map))
  :config
  (setq projectile-mode-line "Projectile")
  (setq projectile-track-known-projects-automatically nil))

(use-package counsel-projectile
  :ensure t
  :after (projectile)
  :init (counsel-projectile-mode))
#+END_SRC
** treemacs å·¥ä½œåŒºç®¡ç†
#+BEGIN_SRC emacs-lisp
;; all-the-icons
;; @source https://github.com/domtronn/all-the-icons.el#installation
;; On Windows, after downloading the fonts, one needs to manually install them
;; M-x package-install RET all-the-icons
;; restart-emacs, M-x all-the-icons-install-fonts
(use-package all-the-icons
  :if (display-graphic-p))

;; depend on all-the-icons
(use-package treemacs
  :ensure t
  :defer t
  :config
  (treemacs-tag-follow-mode)
  :bind
  (:map global-map
        ("M-0"       . treemacs-select-window)
        ("C-x t 1"   . treemacs-delete-other-windows)
        ("C-x t t"   . treemacs)
        ("C-x t B"   . treemacs-bookmark)
        ;; ("C-x t C-t" . treemacs-find-file)
        ("C-x t M-t" . treemacs-find-tag))
  (:map treemacs-mode-map
	("/" . treemacs-advanced-helpful-hydra)))

(use-package treemacs-projectile
  :ensure t
  :after (treemacs projectile))

(use-package lsp-treemacs
  :ensure t
  :after (treemacs lsp))
#+END_SRC
** magit ç‰ˆæœ¬ç®¡ç†
+ åœ¨ Emacs é‡Œè¿›è¡ŒåŸºäº magit çš„ç‰ˆæœ¬æ§åˆ¶
#+BEGIN_SRC emacs-lisp
;; magit
;;; scoop install git
;;; scoop install delta @ https://github.com/dandavison/delta
;;; fix ~/.gitconfig
(use-package magit
  :ensure t
  :hook (git-commit-mode . flyspell-mode)
  :bind (("C-x g"   . magit-status)
         ("C-x M-g" . magit-dispatch)
         ("C-c M-g" . magit-file-dispatch))
  :custom
  (magit-diff-refine-hunk t)
  (magit-ediff-dwim-show-on-hunks t))
#+END_SRC
** diff-hl é«˜äº®æ˜¾ç¤ºä¿®æ”¹éƒ¨åˆ†
+ [[https://github.com/dgutov/diff-hl][diff-hl]] æ’ä»¶åœ¨å·¦ä¾§é«˜äº®æ˜¾ç¤ºç›¸å¯¹äºè¿œç¨‹ä»“åº“çš„ä¿®æ”¹éƒ¨åˆ†
#+BEGIN_SRC emacs-lisp
;; diff-hl
(use-package diff-hl
  :ensure t
  :hook ((dired-mode         . diff-hl-dired-mode-unless-remote)
         (magit-pre-refresh  . diff-hl-magit-pre-refresh)
         (magit-post-refresh . diff-hl-magit-post-refresh))
  :init
  (global-diff-hl-mode t)
  :config
  ;; When Emacs runs in terminal, show the indicators in margin instead.
  (unless (display-graphic-p)
    (diff-hl-margin-mode)))
#+END_SRC
** magit-delta å¢å¼º git diff
#+BEGIN_SRC emacs-lisp
(use-package magit-delta
  :ensure t
  :hook (magit-mode . magit-delta-mode)
  :config
  (setq magit-delta-hide-plus-minus-markers nil)
  )
#+END_SRC
** paren é«˜äº®åŒ¹é…æ‹¬å·
#+BEGIN_SRC emacs-lisp
(use-package paren
  :ensure nil
  :hook (after-init . show-paren-mode)
  :custom
  (show-paren-when-point-inside-paren t)
  (show-paren-when-point-in-periphery t))
#+END_SRC
** rainbow-delimeters å¤šå½©æ‹¬å·
+ [[https://github.com/Fanael/rainbow-delimiters][rainbow-delimiters]] æ’ä»¶å¤šå½©æ˜¾ç¤ºæ‹¬å·ç­‰åˆ†éš”ç¬¦
#+BEGIN_SRC emacs-lisp
(use-package rainbow-delimiters
  :ensure t
  :hook (prog-mode . rainbow-delimiters-mode))
#+END_SRC
** emacs-lisp è¯­è¨€è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package elisp-mode
  :ensure nil
  :after org
  :bind (:map emacs-lisp-mode-map
              ("C-c C-b" . eval-buffer)
              ("C-c C-c" . eval-to-comment)
              :map lisp-interaction-mode-map
              ("C-c C-c" . eval-to-comment)
              :map org-mode-map
              ("C-c C-;" . eval-to-comment)
              )
  :init
  ;; for emacs-lisp org babel
  (add-to-list 'org-babel-default-header-args:emacs-lisp
             '(:results . "value pp"))
  :config
  (defconst eval-as-comment-prefix " â‡’ ")
  (defun eval-to-comment (&optional arg)
    (interactive "P")
    ;; (if (not (looking-back ";\\s*"))
    ;;     (call-interactively 'comment-dwim))
    (call-interactively 'comment-dwim)
    (progn
      (search-backward ";")
      (forward-char 1))
    (delete-region (point) (line-end-position))
    (save-excursion
      (let ((current-prefix-arg '(4)))
        (call-interactively 'eval-last-sexp)))
    (insert eval-as-comment-prefix)
    (end-of-line 1))
  )
#+END_SRC
** markdown-mode è®¾ç½®
#+BEGIN_SRC emacs-lisp
(use-package markdown-mode
  :ensure t
  :mode ("README\\.md\\'" . gfm-mode)
  :init (setq markdown-command "multimarkdown")
  :bind (:map markdown-mode-map
              ("C-c C-e" . markdown-do)))
#+END_SRC
** init-dev.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-dev)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dev.el ends here
#+END_SRC
* init-research.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-research.el :mkdirp yes
:END:
** init-research.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-research.el --- Research settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** åŠ è½½ cdLaTeX
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/lisp/")
(require 'cdlatex)
#+END_SRC
** LaTeX æ¨¡å¼è®¾ç½®
#+BEGIN_SRC emacs-lisp
;; æ‰“å¼€TeXæ–‡ä»¶æ—¶åº”æ‰§è¡Œçš„å‘½ä»¤
(defun my-latex-hook ()
  (turn-on-cdlatex)          ;; åŠ è½½cdlatex
  (turn-on-reftex)           ;; åŠ è½½reftex
  (prettify-symbols-mode t)  ;; åŠ è½½prettify-symbols-mode
  (outline-minor-mode)       ;; åŠ è½½outline-mode
  (outline-hide-body))       ;; æ‰“å¼€æ–‡ä»¶æ—¶åªæ˜¾ç¤ºç« èŠ‚æ ‡é¢˜
#+END_SRC
** Prettify
#+BEGIN_SRC emacs-lisp
;; customize prettify
;; https://en.wikipedia.org/wiki/Mathematical_operators_and_symbols_in_Unicode
;; å¯åŠ å…¥åŸåˆ—è¡¨ä¸­æ²¡æœ‰çš„ç¼–ç ã€ç®€åŒ–å¸¸ç”¨å‘½ä»¤
(require 'tex-mode) ;; è½½å…¥ tex--prettify-symbols-alist å˜é‡
(defun my/more-prettified-symbols ()
  (mapc (lambda (pair) (delete pair tex--prettify-symbols-alist))
        '(("\\supset" . 8835)))
  (mapc (lambda (pair) (cl-pushnew pair tex--prettify-symbols-alist))
        '(("\\Z" . 8484)
          ("\\Q" . 8474)
          ("\\N" . 8469)
          ("\\R" . 8477)
          ("\\eps" . 949)
          ("\\inf" . #x22C0) 
          ("\\sup". #x22C1)
          ("\\ONE" . #x1D7D9)
          ("\\mathbb{S}" . #x1D54A)
          ("\\PP" . #x2119)
          ("\\Ps" . #x1D5AF )
          ("\\Pp" . #x1D40F)
          ("\\E" . #x1D5A4)
          ("\\Ee" . #x1D404)
          ("\\EE" . #x1D53C )
          ("\\Fc" . #x2131)
          ("\\Nc" . #x1D4A9))))
(my/more-prettified-symbols) ;; è¯»å…¥è‡ªå®šä¹‰ prettify ç¬¦å·

(setq prettify-symbols-unprettify-at-point t)  ;; è‡ªåŠ¨å±•å¼€å…‰æ ‡é™„è¿‘çš„å®å‘½ä»¤
#+END_SRC
** TeX åŸºç¡€é…ç½®
#+BEGIN_SRC emacs-lisp
;; tex
;; @source https://github.com/jwiegley/use-package/issues/379#issuecomment-246161500
(use-package tex
  :defer t
  :ensure auctex
  :custom
  ;; å¯¹æ–°æ–‡ä»¶è‡ªåŠ¨è§£æ (usepackage, bibliograph, newtheorem) ç­‰ä¿¡æ¯
  (TeX-parse-selt t)
  (TeX-PDF-mode t)
  ;; æ­£å‘ä¸åå‘æœç´¢è®¾ç½®
  (TeX-source-correlate-mode t)
  (TeX-source-correlate-method 'synctex)
  ;; ä½¿ç”¨pdf-toolsæ‰“å¼€PDF
  (TeX-view-program-selection '((output-pdf "PDF Tools")))
  :config
  (setq TeX-auto-save t)
  ;; ç¼–è¯‘æ—¶é—®è¯¢ä¸»æ–‡ä»¶åç§°
  (setq-default TeX-master t)                               
  ;; ç¼–è¯‘åæ›´æ–°pdfæ–‡ä»¶
  (add-hook 'TeX-after-compilation-finished-functions #'TeX-revert-document-buffer)
  ;; åŠ è½½LaTeXæ¨¡å¼è®¾ç½®
  (add-hook 'LaTeX-mode-hook 'my-latex-hook)
  ;; XeLaTeX æ”¯æŒ
  (add-hook 'LaTeX-mode-hook (lambda()
  (add-to-list 'TeX-command-list '("XeLaTeX" "%`xelatex%(mode)%' %t" TeX-run-TeX nil t))
  (setq TeX-save-query  nil )
  (setq TeX-show-compilation t))))
#+END_SRC
** pdf-tools PDFé˜…è¯»å™¨
#+BEGIN_SRC emacs-lisp
;; pdf-tools
;;; Windows Installation
;;;; M-x package-list-packages -> pdf-tools (from melpa-stable)
;;;; scoop install msys2
;;;; open mingw64.exe under msys2
;;;; pacman -S mingw-w64-x86_64-texlive-full
;;;; pacman -S mingw-w64-x86_64-emacs-pdf-toool-s-server
;;;; add E:\Scoop\apps\msys2\current\mingw64\bin to environment variable
(use-package pdf-tools
  :mode ("\\.pdf\\'" . pdf-view-mode)                           ;; pdf æ–‡ä»¶é»˜è®¤æ‰“å¼€æ–¹å¼
  :bind
  (:map pdf-view-mode-map
        ("d" . pdf-view-next-page-command)                      ;; å‘åç¿»é¡µ
        ("a" . pdf-view-previous-page-command)                  ;; å‘å‰ç¿»é¡µ
        ("s" . pdf-view-scroll-up-or-next-page)                 ;; å‘ä¸‹æ»‘åŠ¨
        ("w" . pdf-view-scroll-down-or-previous-page)           ;; å‘ä¸Šæ»‘åŠ¨
   :map pdf-history-minor-mode-map
        ("b" . pdf-history-backward)
   :map pdf-annot-minor-mode-map
        ("C-a a" . pdf-annot-add-highlight-markup-annotation)
        ("C-a s" . pdf-annot-add-squiggly-markup-annotation)
        ("C-a u" . pdf-annot-add-underline-markup-annotation)
        ("C-a d" . pdf-annot-delete))
  :custom
  (pdf-view-midnight-colors '("#000000" . "#9bCD9b"))           ;; å¤œé—´æ¨¡å¼è®¾ç½®ç»¿è‰²åº•è‰²
  (native-comp-deferred-compilation-deny-list '(".*pdf.*"))     ;; ç¦ç”¨ =pdf-tools= æœ‰å…³æ–‡ä»¶çš„æœ¬åœ°ç¼–è¯‘
  :config
  (require 'pdf-annot)                                          ;; è®¾ç½® pdf-annot-minor-mode-map
  (require 'pdf-history)                                        ;; è®¾ç½® pdf-history-minor-mode-map
  (add-hook 'pdf-view-mode-hook 'pdf-view-midnight-minor-mode)  ;; é»˜è®¤å¤œé—´æ¨¡å¼
  (add-hook 'pdf-view-mode-hook 'pdf-view-fit-width-to-window)  ;; æ‰“å¼€PDFæ—¶è‡ªåŠ¨ç¼©æ”¾
  (pdf-tools-install))
#+END_SRC
** org-download
#+BEGIN_SRC emacs-lisp
;; å¯¹äºWindowsç³»ç»Ÿï¼Œéœ€è¦å®‰è£…ImageMagickï¼Œå¹¶ä¿è¯magick.exeåœ¨PATHå˜é‡çš„è·¯å¾„ä¸­
;;; ç”¨msys2å®‰è£…: pacman -S mingw-w64-x86_64-imagemagick
(use-package org-download
  :ensure async ;; å› ä¸ºä¸æ˜¯ä»melpaå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨ä¿è¯asyncå®‰è£…
  :defer t ;; å»¶è¿ŸåŠ è½½
  :load-path "~/.emacs.d/lisp/"
  :bind
  (:map org-mode-map
        ("C-M-y" . org-download-clipboard)) ;; ç»‘å®šä»å‰ªè´´æ¿ç²˜è´´æˆªå›¾çš„å¿«æ·é”®
  :custom
  (org-download-heading-lvl 1) ;; ç”¨ä¸€çº§æ ‡é¢˜ç»™æˆªå›¾æ–‡ä»¶å‘½å
  :config
  ;; ç”¨åŒçº§ ./img ç›®å½•æ”¾ç½®æˆªå›¾æ–‡ä»¶
  (setq-default org-download-image-dir "./img"))
#+END_SRC
** org-noter
#+BEGIN_SRC emacs-lisp
(use-package org-noter
  :ensure t
  :defer t
  :custom
  (org-noter-notes-search-path '("~/org/notes/")) ;; é»˜è®¤ç¬”è®°è·¯å¾„ã€‚è®¾ç½®åä»pdfæ–‡ä»¶ä¸­ä½¿ç”¨=org-noter=å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨åœ¨è¯¥å¢“ä¸­å¯»æ‰¾ä¸æ–‡ä»¶åŒåçš„=.org=ç¬”è®°æ–‡ä»¶
  (org-noter-auto-save-last-location t) ;; è‡ªåŠ¨ä¿å­˜ä¸Šæ¬¡é˜…è¯»ä½ç½®
  (org-noter-max-short-selected-text-length 20) ;; ä¿®æ”¹é•¿/çŸ­æ–‡æœ¬æ ‡å‡†ï¼Œé»˜è®¤ä¸º80
  (org-noter-default-heading-title "ç¬¬ $p$ é¡µçš„ç¬”è®°") ;; é»˜è®¤çŸ­æ ‡é¢˜æ ¼å¼
  (org-noter-highlight-selected-text t) ;; é€‰ä¸­æ–‡å­—åæ’å…¥ç¬”è®°è‡ªåŠ¨é«˜äº®
  :bind
  (("C-c n n" . org-noter) ;; ä¸org-roamé…åˆï¼Œæ‰“å¼€org-noterçš„å¿«æ·é”®
   :map org-noter-doc-mode-map ;; åŠ å…¥å·¦æ‰‹é”®ä½
   ("e" . org-noter-insert-note)
   ("M-e" . org-noter-insert-precise-note)))
#+END_SRC
** init-research.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-research)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-research.el ends here
#+END_SRC
* init-eaf.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-eaf.el :mkdirp yes
:END:
** init-eaf.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-eaf.el --- emacs-application-framework settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** emacs-application-framework
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/site-lisp/emacs-application-framework/")
(require 'eaf)
;;; é…ç½® EAF ä»£ç†
(setq eaf-proxy-type "http")
(setq eaf-proxy-host "127.0.0.1")
(setq eaf-proxy-port "7890")

;; eaf-browser
(require 'eaf-browser)
(setq eaf-browser-continue-where-left-off t)
(setq eaf-browser-enable-adblocker t)
(setq browse-url-browser-function 'eaf-open-browser)

;; eaf-rss-reader
;;; ä¸€äº›ä¼˜è´¨RSSè®¢é˜…æº
;;; https://manateelazycat.github.io/feed.xml          ;; manateeLazyCat
;;; https://superliooon.com/feed/                      ;; å³å‡‰
;;; http://blindwith.science/index.xml                 ;; Blind with Science
;;; https://remacs.cc/index.xml                        ;; remacsçš„ä¸–ç•Œ
;;; https://www.bmpi.dev/index.xml                     ;; BMPI
;;; http://feeds.feedburner.com/ruanyifeng             ;; Ruan YiFeng
;;; https://emacstalk.codeberg.page/podcast/index.xml  ;; EmacsTalk
;;; https://arxiv.org/rss/cs.CV                        ;; ArXiv CV
;;; https://sachachua.com/blog/feed/                   ;; Sacha Chua
;;; https://byvoid.com/zhs/feed.xml                    ;; byvoid
;;; https://www.skyue.com/feed                         ;; skyue
(require 'eaf-rss-reader)

;; eaf-git
(require 'eaf-git)
;; eaf-pdf-viewer
(require 'eaf-pdf-viewer)
;; eaf-image-viewer
(require 'eaf-image-viewer)
;; eaf-video-player
(require 'eaf-video-player)
;; eaf-music-player
(require 'eaf-music-player)

; ä¸‹åˆ—åº”ç”¨åœ¨Windowså¹³å°æœªé€šè¿‡ç¼–è¯‘, åœ¨Manjaroå¹³å°ç¼–è¯‘æˆåŠŸ

;; eaf-terminal
(require 'eaf-terminal)
;; eaf-file-manager
(require 'eaf-file-manager)
;; eaf-system-monitor
(require 'eaf-system-monitor)
;; eaf-markdown-previewer
(require 'eaf-markdown-previewer)
;; eaf-org-previewer
(require 'eaf-org-previewer)
#+END_SRC
** init-eaf.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-eaf)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-eaf.el ends here
#+END_SRC
* init-ai.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-ai.el :mkdirp yes
:END:
** init-ai.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-ai.el --- AI Tools settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** mind-wave
+ [[https://github.com/manateelazycat/mind-wave][mind-wave]] æ˜¯ manateeLazyCat åŸºäºChatGPT APIå¼€å‘çš„AIæ’ä»¶
#+BEGIN_SRC emacs-lisp
(add-to-list 'load-path "~/.emacs.d/mind-wave/")
(require 'mind-wave)
(setq mind-wave-auto-change-title nil) ; é¿å…ä¸auto-saveæ’ä»¶çš„å†²çª
#+END_SRC
** init-ai.el æ–‡ä»¶å°¾
#+BEGIN_SRC emacs-lisp
(provide 'init-ai)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-ai.el ends here
#+END_SRC
* init-shell.el
:PROPERTIES:
:HEADER-ARGS: :tangle lisp/init-shell.el :mkdirp yes
:END:
** init-shell.el æ–‡ä»¶å¤´
#+BEGIN_SRC emacs-lisp
;;; init-shell.el --- (E)shell settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:
#+END_SRC
** eshell åŸºæœ¬é…ç½®
#+BEGIN_SRC emacs-lisp
(use-package eshell
  :ensure nil
  :functions eshell/alias
  :hook ((eshell-mode . (lambda ()
                          (term-mode-common-init)
                          ;; Remove cmd args word by word
                          (modify-syntax-entry ?- "w")
                          (visual-line-mode 1)
                          (setenv "PAGER" "cat")))
         )
  :config
  (defun term-mode-common-init ()
    "The common initialization for term."
    (setq-local scroll-margin 0)
    (setq-local truncate-lines t)
    )

  ;; åœ¨Emacsé‡Œè¾“å…¥viï¼Œç›´æ¥åœ¨bufferé‡Œæ‰“å¼€æ–‡ä»¶
  (defalias 'eshell/vi 'find-file)
  (defalias 'eshell/vim 'find-file)

  ;; è¯­æ³•é«˜äº®æ˜¾ç¤º
  (defun eshell/bat (file)
    "cat FILE with syntax highlight."
    (with-temp-buffer
      (insert-file-contents file)
      (let ((buffer-file-name file))
        (delay-mode-hooks
          (set-auto-mode)
          (font-lock-ensure)))
      (buffer-string)))
  (defalias 'eshell/cat 'eshell/bat)

  ;; äº¤äº’å¼è¿›å…¥ç›®å½•
  (defun eshell/z ()
    "cd to directory with completion."
    (let ((dir (completing-read "Directory: " (ring-elements eshell-last-dir-ring) nil t)))
      (eshell/cd dir)))

  ;; æŸ¥æ‰¾æ–‡ä»¶
  (defun eshell/f (filename &optional dir)
    "Search for files matching FILENAME in either DIR or the
current directory."
    (let ((cmd (concat
                ;; using find
                (executable-find "find")
                " " (or dir ".")
                " -not -path '*/.git*'"            ; ignore .git directory
                " -and -not -path 'build'"         ; ignore cmake build directory
                " -and -not -path '*/eln-cache*'"  ; ignore eln cache
                " -and -type f -and -iname "
                "'*" filename "*'")))
      (eshell-command-result cmd)))

  :custom
  (eshell-banner-message
   '(format "%s %s\n"
            (propertize (format " %s " (string-trim (buffer-name)))
                        'face 'mode-line-highlight)
            (propertize (current-time-string)
                        'face 'font-lock-keyword-face)))
  (eshell-scroll-to-bottom-on-input 'all)
  (eshell-scroll-to-bottom-on-output 'all)
  (eshell-kill-on-exit t)
  (eshell-kill-processes-on-exit t)
  ;; Don't record command in history if starts with whitespace
  (eshell-input-filter 'eshell-input-filter-initial-space)
  (eshell-error-if-no-glob t)
  (eshell-glob-case-insensitive t)
  ;; set scripts
  (eshell-rc-script (locate-user-emacs-file "etc/eshell/profile"))
  (eshell-login-script (locate-user-emacs-file "etc/eshell/login"))
  )
#+END_SRC
** eshell çš„ alias
#+BEGIN_SRC emacs-lisp :tangle etc/eshell/aliases
alias ff find-file $1
alias fo find-file-other-window $1
alias d dired $1
alias ll ls -alh
alias l. ls -dh .*
alias up eshell-up $1
alias pk eshell-up-peek $1
alias less view-file $1
alias more view-file $1
#+END_SRC
** eshell é‡Œçš„ C-d
+ æˆ‘ä»¬åœ¨ä½¿ç”¨ =iterm= æ—¶ï¼Œç»å¸¸ä¼šä½¿ç”¨ =C-d= æ¥ç»“æŸçª—å£
+ åœ¨ =Emacs= é‡Œï¼Œè¿™ä¸ªå¿«æ·é”®ç»‘å®šçš„æ˜¯ =delete-char= å‡½æ•°ï¼Œé€šè¿‡ä»¥ä¸‹è®¾ç½®ä»¤ =C-d= æ›´æ™ºèƒ½ï¼š
+ å½“å…‰æ ‡åé¢æœ‰å­—ç¬¦çš„æ—¶å€™ï¼Œåˆ é™¤å…‰æ ‡åçš„å­—ç¬¦ï¼Œå½“æ²¡æœ‰å­—ç¬¦çš„æ—¶å€™ï¼Œç›´æ¥é€€å‡ºå½“å‰ shellã€‚
#+BEGIN_SRC emacs-lisp
(use-package em-rebind
  :ensure nil
  :commands eshell-delchar-or-maybe-eof)

(use-package esh-mode
  :ensure nil
  :bind (:map eshell-mode-map
              ("C-d" . eshell-delchar-or-maybe-eof)
              ("C-r" . consult-history)
              ("C-l" . eshell/clear))
  )
#+END_SRC
** eshell çš„å‘½ä»¤å†å²
+ æ‰©å¤§ =eshell= çš„å†å²è®°å½•ï¼š
#+BEGIN_SRC emacs-lisp
(use-package em-hist
  :ensure nil
  :defer t
  :custom
  (eshell-history-size 1024)
  (eshell-hist-ignoredups t)
  (eshell-save-history-on-exit t))
#+END_SRC
** æœ‰äº›ä½¿ç”¨termçš„å‘½ä»¤
+ å‘½ä»¤å¦‚ topï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ term
#+BEGIN_SRC emacs-lisp
;; following commands will run on term instead
(use-package em-term
  :ensure nil
  :defer t
  :custom
  (eshell-visual-commands '("top" "htop" "less" "more"))
  (eshell-visual-subcommands '(("git" "help" "lg" "log" "diff" "show")))
  (eshell-visual-options '(("git" "--help" "--paginate")))
  (eshell-destroy-buffer-when-process-dies t))
#+END_SRC
** æ”¹å˜eshellçš„ä¸»é¢˜
+ [[https://github.com/xuchunyang/eshell-git-prompt][eshell-git-prompt]] æä¾›äº†æ•°ä¸ªå¥½çœ‹çš„ =Eshell= å‘½ä»¤è¡Œä¸»é¢˜
#+BEGIN_SRC emacs-lisp
(use-package eshell-git-prompt
  :ensure t
  :after esh-mode
  :custom-face
  (eshell-git-prompt-multiline2-dir-face ((t (:foreground "#c09035" :bold t))))
  :config
  (eshell-git-prompt-use-theme 'multiline2)
  )
#+END_SRC
** eshell-syntac-highlighting è¯­æ³•é«˜äº®
+ [[https://github.com/akreisher/eshell-syntax-highlighting][eshell-syntax-highlighting]] ä¸º =Eshell= æä¾›è¯­æ³•é«˜äº®
#+BEGIN_SRC emacs-lisp
(use-package eshell-syntax-highlighting
  :after esh-mode
  :ensure t
  :hook (eshell-mode . eshell-syntax-highlighting-global-mode)
  :custom-face
  (eshell-syntax-highlighting-shell-command-face ((t (:foreground "#7cc77f" :bold t))))
  )
#+END_SRC
** capf-autosuggest è‡ªåŠ¨è¡¥å…¨
+ [[https://github.com/emacsmirror/capf-autosuggest][capf-autosuggest]] æä¾› =Fish= ç±»ä¼¼çš„ =Eshell= å‘½ä»¤è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½
#+BEGIN_SRC emacs-lisp
(use-package capf-autosuggest
  :ensure t
  :hook ((eshell-mode comint-mod) . capf-autosuggest-mode)
  )
#+END_SRC
** eshell-up å¿«é€Ÿè¿›å…¥çˆ¶ç›®å½•
+ [[https://github.com/peterwvj/eshell-up][eshell-up]] æ’ä»¶å¯å¿«é€Ÿè¿›å…¥å½“å‰æ–‡ä»¶å¤¹çš„ä»»ä½•çˆ¶æ–‡ä»¶å¤¹
+ =up= å‘½ä»¤è¿›å…¥åˆ°å½“å‰æ–‡ä»¶å¤¹çš„ä»»æ„ä¸€çº§çˆ¶ç›®å½•
#+BEGIN_SRC emacs-lisp
(use-package eshell-up
  :ensure t
  :commands (eshell-up eshell-up-peek)
  :config
  ;; to print the matching parent directory before changing to it
  (setq eshell-up-print-parent-dir t)
  )
#+END_SRC
** init-shell.el æ–‡ä»¶å°¾
:PROPERTIES:
:NOTER_DOCUMENT: d:/research/LFRS/Literature/foundationModel/VLP/Masked Autoencoders Are Scalable Vision Learners.pdf
:END:
#+BEGIN_SRC emacs-lisp
(provide 'init-shell)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-shell.el ends here
#+END_SRC
